<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Roland Huß">
<title>fabric8io/fabric8-maven-plugin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>fabric8io/fabric8-maven-plugin</h1>
<div class="details">
<span id="author" class="author">Roland Huß</span><br>
<span id="revnumber">version 3.1.42,</span>
<span id="revdate">2016-09-21</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">fabric8-maven-plugin</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#building-images">1.1. Building Images</a></li>
<li><a href="#resource-descriptors">1.2. Kubernetes and OpenShift Resources</a></li>
<li><a href="#configuration">1.3. Configuration</a></li>
<li><a href="#examples">1.4. Examples</a>
<ul class="sectlevel3">
<li><a href="#zero-config">1.4.1. Zero-Config</a></li>
<li><a href="#xml-configuration">1.4.2. XML Configuration</a></li>
<li><a href="#resource-fragments">1.4.3. Resource Fragments</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#installation">2. Installation</a></li>
<li><a href="#goals">3. Goals</a>
<ul class="sectlevel2">
<li><a href="#fabric8:setup">3.1. <strong>fabric8:setup</strong></a></li>
<li><a href="#fabric8:cluster-start">3.2. <strong>fabric8:cluster-start</strong></a>
<ul class="sectlevel3">
<li><a href="#using-openshift">3.2.1. Using OpenShift</a></li>
<li><a href="#configure-apps">3.2.2. Configure apps</a></li>
<li><a href="#configure-cluster-resources">3.2.3. Configure cluster resources</a></li>
<li><a href="#stop">3.2.4. Stop</a></li>
</ul>
</li>
<li><a href="#fabric8:cluster-stop">3.3. <strong>fabric8:cluster-stop</strong></a>
<ul class="sectlevel3">
<li><a href="#restarting">3.3.1. Restarting</a></li>
<li><a href="#deleting">3.3.2. Deleting</a></li>
</ul>
</li>
<li><a href="#fabric8:run">3.4. <strong>fabric8:run</strong></a></li>
<li><a href="#fabric8:deploy">3.5. <strong>fabric8:deploy</strong></a></li>
<li><a href="#fabric8:undeploy">3.6. <strong>fabric8:undeploy</strong></a></li>
<li><a href="#fabric8:start">3.7. <strong>fabric8:start</strong></a>
<ul class="sectlevel3">
<li><a href="#scaling">3.7.1. Scaling</a></li>
</ul>
</li>
<li><a href="#fabric8:stop">3.8. <strong>fabric8:stop</strong></a></li>
<li><a href="#fabric8:log">3.9. <strong>fabric8:log</strong></a></li>
<li><a href="#fabric8:debug">3.10. <strong>fabric8:debug</strong></a></li>
<li><a href="#fabric8:import">3.11. <strong>fabric8:import</strong></a></li>
<li><a href="#fabric8:resource">3.12. <strong>fabric8:resource</strong></a>
<ul class="sectlevel3">
<li><a href="#resource-labels-annotations">3.12.1. Labels and Annotations</a></li>
</ul>
</li>
<li><a href="#fabric8:resource-apply">3.13. <strong>fabric8:resource-apply</strong></a></li>
<li><a href="#fabric8:build">3.14. <strong>fabric8:build</strong></a>
<ul class="sectlevel3">
<li><a href="#build-kubernetes">3.14.1. Kubernetes Build</a></li>
<li><a href="#build-openshift">3.14.2. OpenShift Build</a></li>
<li><a href="#build-goal-configuration">3.14.3. Configuration</a></li>
<li><a href="#image-configuration">3.14.4. Image Configuration</a></li>
<li><a href="#build-configuration">3.14.5. Build Configuration</a></li>
<li><a href="#build-assembly">3.14.6. Assembly</a></li>
<li><a href="#misc-env">3.14.7. Environment and Labels</a></li>
<li><a href="#misc-startup">3.14.8. Startup Arguments</a></li>
<li><a href="#build-buildargs">3.14.9. Build Args</a></li>
</ul>
</li>
<li><a href="#fabric8:push">3.15. <strong>fabric8:push</strong></a></li>
<li><a href="#fabric8:install">3.16. <strong>fabric8:install</strong></a></li>
<li><a href="#fabric8:helm">3.17. <strong>fabric8:helm</strong></a></li>
<li><a href="#fabric8:helm-index">3.18. <strong>fabric8:helm-index</strong></a></li>
<li><a href="#fabric8:app-catalog">3.19. <strong>fabric8:app-catalog</strong></a></li>
<li><a href="#fabric8:distro">3.20. <strong>fabric8:distro</strong></a></li>
</ul>
</li>
<li><a href="#generators">4. Generators</a>
<ul class="sectlevel2">
<li><a href="#generators-default">4.1. Default Generators</a>
<ul class="sectlevel3">
<li><a href="#generator-spring-boot">4.1.1. Spring Boot</a></li>
<li><a href="#java-applications">4.1.2. Java Applications</a></li>
<li><a href="#karaf">4.1.3. Karaf</a></li>
</ul>
</li>
<li><a href="#generators-api">4.2. Generator API</a></li>
</ul>
</li>
<li><a href="#enrichers">5. Enrichers</a>
<ul class="sectlevel2">
<li><a href="#enrichers-default">5.1. Default Enrichers</a>
<ul class="sectlevel3">
<li><a href="#enrichers-standard">5.1.1. Standard Enrichers</a></li>
<li><a href="#enrichers-fabric8">5.1.2. Fabric8 Enrichers</a></li>
</ul>
</li>
<li><a href="#enricher-api">5.2. Enricher API</a></li>
</ul>
</li>
<li><a href="#profiles">6. Profiles</a></li>
<li><a href="#access-configuration">7. Access configuration</a>
<ul class="sectlevel2">
<li><a href="#docker-access">7.1. Docker Access</a></li>
<li><a href="#openshift-and-kubernetes-access">7.2. OpenShift and Kubernetes Access</a></li>
</ul>
</li>
<li><a href="#registry">8. Registry handling</a></li>
<li><a href="#authentication">9. Authentication</a>
<ul class="sectlevel2">
<li><a href="#pull-vs-push-authentication">9.1. Pull vs. Push Authentication</a></li>
<li><a href="#openshift-authentication">9.2. OpenShift Authentication</a></li>
<li><a href="#password-encryption">9.3. Password encryption</a></li>
</ul>
</li>
<li><a href="#migration">10. Migration from version 2</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2016 The original authors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>fabric8-maven-plugin</strong> (f8-m-p) brings your Java applications on to <a href="http://kubernetes.io/">Kubernetes</a> and <a href="https://www.openshift.com/">OpenShift</a>.  It provides a tight integration into <a href="http://maven.apache.org">Maven</a> builds and benefits from the build information already provided. This plugin focus on two tasks: <em>Building Docker images</em> and <em>creating Kubernetes and OpenShift resource descriptors</em>. It can be configured very flexibly and supports multiple configuration models for creating : A <em>Zero-Config</em> setup allows for a quick ramp-up with some opinionated defaults. For more advanced requirementes an <em>XML configuration</em> provides additional configuration options which can be added to the pom.xml. For the full power in order to tune all facets of the creation external <em>resource fragments</em> and <em>Dockerfiles</em> can be used.</p>
</div>
<div class="paragraph">
<p>This introduction will explain how f8-m-p supports these tasks and demonstrates the different configuration models with examples.</p>
</div>
<div class="sect2">
<h3 id="building-images">1.1. Building Images</h3>
<div class="paragraph">
<p>The <a href="#fabric8:build"><strong>fabric8:build</strong></a> goal is for creating Docker images which carry the actual application and which can be deployed on Kubernetes or OpenShift. It is easy to include build artifacts and their dependencies. The plugin uses the assembly descriptor format from the <a href="http://maven.apache.org/plugins/maven-assembly-plugin/">maven-assembly-plugin</a> to specify the content which will be added to a sub-directory in the image (<code>/deployments</code> by default). Images that are built with this plugin can then be pushed to public or private Docker registries with <a href="#fabric8:push"><strong>fabric8:push</strong></a>.</p>
</div>
<div class="paragraph">
<p>Depending on the operational mode, for building the actual image either a Docker daemon is contacted directly or an <a href="https://docs.openshift.com/enterprise/3.0/architecture/core_concepts/builds_and_image_streams.html#docker-build">OpenShift Docker Build</a> is performed.</p>
</div>
<div class="paragraph">
<p>A special <a href="#fabric8:watch">[fabric8:watch]</a> goal allows for reacting on code changes and automatic recreation of images or copying new artifacts into running container.</p>
</div>
<div class="paragraph">
<p>These image related features are inherited from the <a href="https://github.com/fabric8io/docker-maven-plugin">fabric8io/docker-maven-plugin</a> which is transparently included in this plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="resource-descriptors">1.2. Kubernetes and OpenShift Resources</h3>
<div class="paragraph">
<p>With <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> Kubernetes and OpenShift resource descriptors can be created from the build information for creating the corresponding resource object. These files are packaged within the Maven artifacts created and can be deployed to a running orchestration platform with <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a>.</p>
</div>
<div class="paragraph">
<p>You only specify a fragment of the real resource descriptors which will be enriched by this plugin with various extra informations taken from the build. This drastically can reduce boilerplate code for common scenarios. It is also possible to auto-create resource objects like services or replica-set without explicitly declaring it.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration">1.3. Configuration</h3>
<div class="paragraph">
<p>In order to capture many use case scenarios, there are three levels of configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Zero-Config</strong> mode makes some decisions based what is present in the pom.xml like what base image to use or which ports to expose. This is great for starting up things and for keeping quickstart applications small and tidy.</p>
</li>
<li>
<p><strong>XML plugin configuration</strong> mode is similar to what <a href="https://fabric8io.github.io/docker-maven-plugin/#example">docker-maven-plugin</a> provides. This allows for type safe configuration with IDE support, but only a subset of possible resource descriptor features is provided.</p>
</li>
<li>
<p><strong>Kubernetes &amp; OpenShift resource fragments</strong> are user provided YAML files that can be <em>enriched</em> by the plugin. This allows expert users to use plain configuration file with all their capabilities, but also to add project specific build information and avoid boilerplate code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table gives an overview of the different models.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Models</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Docker Images</th>
<th class="tableblock halign-left valign-top">Resource Descriptors</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zero-Config</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#generators">Generators</a> are used to creatin Docker image configurations. Generators can detect certain aspects of the build (e.g. whether Spring Boot is used) and then choose some default like the base image, which ports to expose and the startup command. The can be configured, but offer only a few options.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default <a href="#enrichers">Enrichers</a> will create a default <em>Service</em> and <em>Deployment</em> (<em>DeploymentConfig</em> for OpenShift) when no other resource objects are provided. Depending on the image they can detect which port to expose in the service. As with Generators, Enrichers support a limited set of configuration options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XML configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">f8-m-p inherits the XML based configuration for building images from the <a href="https://fabric8io.github.io/docker-maven-plugin/#docker:build">docker-maven-plugin</a> and provides the same functionality. It supports an <a href="http://maven.apache.org/components/plugins/maven-assembly-plugin/assembly.html">assembly descriptor</a> for specifying the content of the Docker image.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A subset of possible resource objects can be configured with a dedicated XML syntax. With a decent IDE you get autocompletion on most object and inline documentation for the available configuration elements. The provide configuration can be still enhanced by Enhancers which is useful for adding e.g. labels and annotation containing build or other information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Fragments</strong> and <strong>Dockerfiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like the docker-maven-plugin f8-m-p supports <a href="#external-dockerfile">external Dockerfiles</a> too, which are referenced from the plugin configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource descriptors can be provied as external YAML files which specify a skeleton. This skeleton is then filled by Enrichers which add labels and more. Maven properties within these files are resolved to thier values. With this model you can use every Kubernetes / OpenShift resource object with all their flexibility, but still get the benefit of adding build informations.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="examples">1.4. Examples</h3>
<div class="paragraph">
<p>Let&#8217;s have a look at some code. The following examples will demonstrate all three configurations variants:</p>
</div>
<div class="sect3">
<h4 id="zero-config">1.4.1. Zero-Config</h4>
<div class="paragraph">
<p>This minimal but full working example <code>pom.xml</code> shows how a simple spring boot application can be dockerized and prepared for Kubernetes and OpenShift. The full example can be found in directory <a href="https://github.com/fabric8io/fabric8-maven-plugin/tree/master/samples/zero-config">samples/zero-config</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span> project<span class="error">&gt;</span>
  <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-sample-zero-config<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;packaging&gt;</span>jar<span class="tag">&lt;/packaging&gt;</span>

  <span class="tag">&lt;parent&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;version&gt;</span>1.3.6.RELEASE<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/parent&gt;</span>

  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>

  <span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;/plugin&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This minimalistic spring boot application uses the spring-boot parent POM for setting up dependencies and plugins</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Spring Boot web starter dependency enables a simple embedded Tomcat for serving Spring MVC apps</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>spring-boot-maven-plugin</code> is responsible for repackaging the application into a fat jar, including all dependencies and the embedded Tomcat</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>fabric8-maven-plugin</code> enables the automatic generation of a Docker image and Kubernetes / OpenShift descriptors including this Spring application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This setup make some opinionated decisions for you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As base image <a href="https://github.com/fabric8io-images/java/tree/master/images/alpine/openjdk8/jdk">fabric8/java-alpine-openjdk8-jdk</a> is chosen which enables <a href="https://www.jolokia.org">Jolokia</a> and <a href="https://github.com/prometheus/jmx_exporter">jmx_exporter</a>. It also comes with a sophisticated <a href="https://github.com/fabric8io-images/run-java-sh">startup script</a>.</p>
</li>
<li>
<p>It will create a Kubernetes <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> and a <a href="http://kubernetes.io/docs/user-guide/services/">Service</a> as resource objects</p>
</li>
<li>
<p>It exports port 8080 as the apllication service port (and 8778 and 9779 for Jolokia and jmx_exporter access, respectively)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These choices can be influenced by configuration options as decribed in <a href="#generator-spring-boot">Spring Boot Generator</a>.</p>
</div>
<div class="paragraph">
<p>To start the Docker image build, you simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn package fabric8:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create the Docker image against a running Docker daemon (which must be accessible either via Unix Socker or with the URL set in <code>DOCKER_HOST</code>). Alternatively, when using <code>mvn -Dfabric8.mode=openshift package fabric8:build</code> and connected to an OpenShift cluster, then a Docker build will be performed on OpenShift which at the end creates an <a href="https://docs.openshift.com/enterprise/3.1/architecture/core_concepts/builds_and_image_streams.html">ImageStream</a>.</p>
</div>
<div class="paragraph">
<p>To deploy the resources to the cluster call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn fabric8:resource fabric8:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default a <em>Service</em> and a <em>Deployment</em> object pointing to the created Docker image is created. When running in OpenShift mode, a <em>Service</em> and <em>DeploymentConfig</em> which refers the <em>ImageStream</em> created with <code>fabric8:build</code> will be installed.</p>
</div>
<div class="paragraph">
<p>Of course you can bind all those fabric8-goals to execution phases as well, so that they are called along with standard lifecycle goals like <code>install</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example for lifecycle bindings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>deploy<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xml-configuration">1.4.2. XML Configuration</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
XML based configuration is implemented only partially and not recommended to use right now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Altough the Zero-config mode with its generators can be tweaked with options up to a certain degree. In many cases more flexibility and power is required, though. For this an XML based plugin configuration can be use, much similar to the <a href="https://fabric8io.github.io/docker-maven-plugin/#configuration">XML configuration</a> used by <code>docker-maven-plugin</code>.</p>
</div>
<div class="paragraph">
<p>The plugin configuration can be roughly divided into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A global configuration options are responsible for tuning the behaviour of plugin goals</p>
</li>
<li>
<p><code>&lt;images&gt;</code> section which defines the Docker <a href="#image-configuratuon">images</a> to build. It has the <a href="https://fabric8io.github.io/docker-maven-plugin/#image-configuration">same syntax</a> as the similar configuration of <code>docker-maven-plugin</code> (except that <code>&lt;run&gt;</code> and <code>&lt;external&gt;</code> sub-elements are ignored)</p>
</li>
<li>
<p><code>&lt;resource&gt;</code> is used to defined the resource descriptors for deploying on an OpenShift or Kuberneres cluster.</p>
</li>
<li>
<p><code>&lt;generator&gt;</code> is for configuring <a href="#generators">generators</a> which are responsible for creating images. Generators are used as an alternative to a dedicates <code>&lt;images&gt;</code> section.</p>
</li>
<li>
<p><code>&lt;enricher&gt;</code> is used to configure various aspects of <a href="#enrichers">enrichers</a> for creating or enhancing resource descriptors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A working example can be found in the  <a href="https://github.com/fabric8io/fabric8-maven-plugin/tree/master/samples/xml-config">samples/xml-config</a> directory. An extract of the plugin configuration is shown in the next example</p>
</div>
<div class="listingblock">
<div class="title">Example for an XML configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;images&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;image&gt;</span>
      <span class="tag">&lt;name&gt;</span>xml-config-demo:1.0.0<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- &quot;alias&quot; is used to correlate to the containers in the pod spec --&gt;</span>
      <span class="tag">&lt;alias&gt;</span>camel-app<span class="tag">&lt;/alias&gt;</span>
      <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;from&gt;</span>fabric8/java<span class="tag">&lt;/from&gt;</span>
        <span class="tag">&lt;assembly&gt;</span>
          <span class="tag">&lt;basedir&gt;</span>/deployments<span class="tag">&lt;/basedir&gt;</span>
          <span class="tag">&lt;descriptorRef&gt;</span>artifact-with-dependencies<span class="tag">&lt;/descriptorRef&gt;</span>
        <span class="tag">&lt;/assembly&gt;</span>
        <span class="tag">&lt;env&gt;</span>
          <span class="tag">&lt;JAVA_LIB_DIR&gt;</span>/deployments<span class="tag">&lt;/JAVA_LIB_DIR&gt;</span>
          <span class="tag">&lt;JAVA_MAIN_CLASS&gt;</span>org.apache.camel.cdi.Main<span class="tag">&lt;/JAVA_MAIN_CLASS&gt;</span>
        <span class="tag">&lt;/env&gt;</span>
      <span class="tag">&lt;/build&gt;</span>
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>

  <span class="tag">&lt;resources&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;labels&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;group&gt;</span>quickstarts<span class="tag">&lt;/group&gt;</span>
    <span class="tag">&lt;/labels&gt;</span>

    <span class="tag">&lt;deployment&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="tag">&lt;name&gt;</span>${project.artifactId}<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;replicas&gt;</span>1<span class="tag">&lt;/replicas&gt;</span>

      <span class="tag">&lt;containers&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="tag">&lt;container&gt;</span>
          <span class="tag">&lt;alias&gt;</span>camel-app<span class="tag">&lt;/alias&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
          <span class="tag">&lt;ports&gt;</span>
            <span class="tag">&lt;port&gt;</span>8778<span class="tag">&lt;/port&gt;</span>
          <span class="tag">&lt;/ports&gt;</span>
          <span class="tag">&lt;mounts&gt;</span>
            <span class="tag">&lt;scratch&gt;</span>/var/scratch<span class="tag">&lt;/scratch&gt;</span>
          <span class="tag">&lt;/mounts&gt;</span>
        <span class="tag">&lt;/container&gt;</span>
      <span class="tag">&lt;/containers&gt;</span>

      <span class="tag">&lt;volumes&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="tag">&lt;volume&gt;</span>
          <span class="tag">&lt;name&gt;</span>scratch<span class="tag">&lt;/name&gt;</span>
          <span class="tag">&lt;type&gt;</span>emptyDir<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/volume&gt;</span>
      <span class="tag">&lt;/volumes&gt;</span>
    <span class="tag">&lt;/deployment&gt;</span>

    <span class="tag">&lt;services&gt;</span> <i class="conum" data-value="8"></i><b>(8)</b>
      <span class="tag">&lt;service&gt;</span>
        <span class="tag">&lt;name&gt;</span>camel-service<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;headless&gt;</span>true<span class="tag">&lt;/headless&gt;</span>
      <span class="tag">&lt;/service&gt;</span>
    <span class="tag">&lt;/services&gt;</span>
  <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Standard docker-maven-plugin configuration for building one single Docker image</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kubernetes / OpenShift resources to create</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Labels which should be applied globally to all resource objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Definition of a <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> to create</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Container to include in the deployment</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An <em>alias</em> is used to correlate a container&#8217;s image with the image definition in the <code>&lt;images&gt;</code> section where each image carry an alias. Can be omitted if only a single image is used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><a href="http://kubernetes.io/docs/user-guide/volumes/">Volume</a> definitions used in a Deployment&#8217;s <em>ReplicaSet</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>One or more <a href="http://kubernetes.io/docs/user-guide/services/">Service</a> definitions.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The XML resource configuration is based on plain Kubernetes resource objects. For creating OpenShift resource descriptor an automatic conversion will happen, e.g. from Kubernetes <a href="http://kubernetes.io/docs/user-guide/deployments/">Deployment</a> to an OpenShift <a href="https://docs.openshift.com/enterprise/3.0/dev_guide/deployments.html">DeploymentConfig</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resource-fragments">1.4.3. Resource Fragments</h4>
<div class="paragraph">
<p>The third configuration option is to use an external configuration in form of YAML resource descriptors which are located in the  <code>src/main/fabric8</code> directory. Each resource get is own file, which contains some skeleton of a resource description. The plugin will pick up the resource, enriches it and the combines all to a single <code>kubernetes.yml</code> and <code>openshift.yml</code>. Within these descriptor files you are can freely use any Kubernetes feature. Note, that in order to support simultaneously both OpenShift and Kubernetes, there is currently no way to specify OpenShift feature only this way (but this might change).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at an example from <a href="https://github.com/rhuss/fabric8-maven-plugin/tree/master/samples/external-resources">samples/external-resources</a>. This is a plain spring-boot application, whose images are auto generated like in the <a href="#zero-config">Zero-Config</a> case. The resource fragments are in <code>src/mainfabric8</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment "deployment.yml"</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spec</span>:
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">spec</span>:
      <span class="key">volumes</span>:
        - <span class="string"><span class="content">name: config</span></span>
          <span class="key">gitRepo</span>:
            <span class="key">repository</span>: <span class="string"><span class="content">'https://github.com/jstrachan/sample-springboot-config.git'</span></span>
            <span class="key">revision</span>: <span class="string"><span class="content">667ee4db6bc842b127825351e5c9bae5a4fb2147</span></span>
            <span class="key">directory</span>: <span class="string"><span class="content">.</span></span>
      <span class="key">containers</span>:
        - <span class="string"><span class="content">volumeMounts:</span><span class="content">
            - name: config
              mountPath: /app/config</span></span>
          <span class="key">env</span>:
            - <span class="string"><span class="content">name: KUBERNETES_NAMESPACE</span></span>
              <span class="key">valueFrom</span>:
                <span class="key">fieldRef</span>:
                  <span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
                  <span class="key">fieldPath</span>: <span class="string"><span class="content">metadata.namespace</span></span>
      <span class="key">serviceAccount</span>: <span class="string"><span class="content">ribbon</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there is no <code>metadata</code> section as expected for each Kubernetes resource object. This section will be created automatically by fabric8-maven-plugin. The object&#8217;s <code>Kind</code>, if not given, will be extracted from the filename. In this case its a <code>Deployment</code> because the file is called <code>deployment.xml</code>. For each supported resource type such a mapping exists. In addition you could specify a name in like in <code>myapp-deployment.xml</code> to give the resource a fixed name. Otherwise it will be automatically extracted from project information (i.e. the artificact id).</p>
</div>
<div class="paragraph">
<p>Here also the reference to the image is missing. In this case it will be automatically connected to the image you are building with this plugin (And you already know, that the image definition comes either from a generator or by a dedicated image plugin configuration).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For building images there is also an alternative mode using external Dockerfiles, in addition to the XML based configuration. Refer to <a href="#build-overview">fabric8:build</a> for details.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Now that we have seen some examples for the various ways how this plugin can be used, the following sections will describe the plugin goals and extension points in detail.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">2. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin is available from Maven central and can be connected to
pre- and post-integration phase as seen below. The configuration and
available goals are described below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>

  <span class="tag">&lt;configuration&gt;</span>
     ....
     <span class="tag">&lt;images&gt;</span>
        <span class="comment">&lt;!-- A single's image configuration --&gt;</span>
        <span class="tag">&lt;image&gt;</span>
          ...
          <span class="tag">&lt;build&gt;</span>
           ....
          <span class="tag">&lt;/build&gt;</span>
        <span class="tag">&lt;/image&gt;</span>
        ....
     <span class="tag">&lt;/images&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>

  <span class="comment">&lt;!-- Connect fabric8:resource, fabric8:build and fabric8:helm to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>fabric8<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goals">3. Goals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin supports the following goals, which are explained in the next sections:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Plugin Goals</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Goal</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:build"><strong>fabric8:build</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:push"><strong>fabric8:push</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Push images to a registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:resource"><strong>fabric8:resource</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create Kubernetes or OpenShift resource descriptors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:helm"><strong>fabric8:helm</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a <a href="https://github.com/kubernetes/helm/blob/master/docs/charts.md#the-chart-file-structure">Helm Chart</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy resources decriptors to a cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><a href="#fabric8:watch">[fabric8:watch]</a></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watch for doing rebuilds and redeployments</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Depending on whether the OpenShift or Kubernetes operational mode is used, the workflow and the performed actions differs :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Workflows</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Use Case</th>
<th class="tableblock halign-left valign-top">Kubernetes</th>
<th class="tableblock halign-left valign-top">OpenShift</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>fabric8:build</code> <code>fabric8:push</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates a image against an exposed Docker daemon (with a <code>docker.tar</code>)</p>
</li>
<li>
<p>Pushes the image to a registry which is then referenced from the configuration</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>fabric8:build</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates or uses a <code>BuildConfig</code></p>
</li>
<li>
<p>Creates or uses an <code>ImageStream</code> which can be referenced by the deployment descriptors in a <code>DeploymenConfig</code></p>
</li>
<li>
<p>Starts an OpenShift build with a <code>docker.tar</code> as input</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>fabric8:deploy</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies a Kubernetes resource descriptor to cluster</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>fabric8:deploy</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies an OpenShift resource descriptor to a cluster</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="fabric8:setup">3.1. <strong>fabric8:setup</strong></h3>
<div class="paragraph">
<p>This goal is for setting up maven projects to use f8-m-p. It can be used to set up afresh this plugin in the <code>pom.xml</code> or to update an existing configuration.</p>
</div>
<div class="paragraph">
<p>To use this goal type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn io.fabric8:fabric8-maven-plugin:3.1.42:setup</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your <code>pom.xml</code> is modified to use f8-m-p. The plugin will be bound some goals to Maven execution phases, so you can test it by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, a Docker image from your application is created (if some of the default generators could detect your setup) and the Kubernetes and OpenShift descriptors are created in <code>target/classes/META-INF/fabric8</code>.</p>
</div>
<div class="paragraph">
<div class="title">Manual Setup</div>
<p>Alternatively, if you prefer to do it all by hand, then add the following to your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>

  <span class="tag">&lt;configuration&gt;</span>
     ....
     <span class="tag">&lt;images&gt;</span>
        <span class="comment">&lt;!-- A single's image configuration --&gt;</span>
        <span class="tag">&lt;image&gt;</span>
          ...
          <span class="tag">&lt;build&gt;</span>
           ....
          <span class="tag">&lt;/build&gt;</span>
        <span class="tag">&lt;/image&gt;</span>
        ....
     <span class="tag">&lt;/images&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>

  <span class="comment">&lt;!-- Connect fabric8:resource and fabric8:build to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>fabric8<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The setup can be influenced with the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Setup configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>updateVersion</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> then an already existing plugin configuration will be updated. Otherwise an existing configuration is left untouched. Default is <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updateVersion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>useVersionProperty</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether we should use a version property for the plugin which is defined in a dedicates <code>&lt;properties&gt;</code> section with the name <code>fabric8.maven.plugin.version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useVersionProperty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>generateBackupPoms</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether a backup pom should be created when the <code>pom.xml</code> is modified. Ddefault is <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generateBackupPoms</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>backupPomFileName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the backup file to create. Default is <code>${basedir}/pom.xml-backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>backupPomFileName</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="fabric8:cluster-start">3.2. <strong>fabric8:cluster-start</strong></h3>
<div class="paragraph">
<p>This goal will start a local kubernetes cluster for local development.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will internally invoke the <a href="#fabric8:install"><strong>fabric8:install</strong></a> goal to ensure that all the required binaries are installed (like <a href="https://github.com/fabric8io/gofabric8/">gofabric8</a>
 and for kubernetes: <a href="http://kubernetes.io/docs/user-guide/kubectl-overview/">kubectl</a> and <a href="https://github.com/kubernetes/minikube">minikube</a> or for OpenShift: <a href="https://docs.openshift.com/enterprise/latest/cli_reference/basic_cli_operations.html">oc</a> and <a href="https://github.com/jimmidyson/minishift">minishift</a>)</p>
</div>
<div class="paragraph">
<p>By default the binaries are installed in <code>~/.fabric8/bin</code></p>
</div>
<div class="sect3">
<h4 id="using-openshift">3.2.1. Using OpenShift</h4>
<div class="paragraph">
<p>By default <code>fabric8:cluster-start</code> will use <code>minikube</code> to create a local single node kubernetes cluster. To specify OpenShift use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start -Dfabric8.cluster.kind=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will then use <code>minishift</code> instead to create a single node local OpenShift cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-apps">3.2.2. Configure apps</h4>
<div class="paragraph">
<p>By default the cluster contains only the <a href="http://fabric8.io/guide/console.html">fabric8 developer console</a> as often developers laptops don&#8217;t have lots of RAM.</p>
</div>
<div class="paragraph">
<p>If you want to deploy the full fabric8 platform (with Nexus, Jenkins, Gogs, JBoss Forge etc) then use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start -Dfabric8.cluster.app=platform</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-cluster-resources">3.2.3. Configure cluster resources</h4>
<div class="paragraph">
<p>You can specify the number of CPUs or memory via additional parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start -Dfabric8.cluster.cpus=2 -Dfabric8.cluster.memory=4096</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configures <code>2</code> CPUs and <code>4Gb</code> of memory</p>
</div>
</div>
<div class="sect3">
<h4 id="stop">3.2.4. Stop</h4>
<div class="paragraph">
<p>You can stop the cluster at any time via <a href="#fabric8:cluster-stop"><strong>fabric8:cluster-stop</strong></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once stopped you can restart again with all the images, resources and pods intact later on by running <code>fabric8:cluster-start</code> again</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:cluster-stop">3.3. <strong>fabric8:cluster-stop</strong></h3>
<div class="paragraph">
<p>This goal will stop a local kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>This goal  stops the VM running the local cluster so it will free up resources on your machine (memory + CPU) though the VM is not destroyed; it can restarted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-stop</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="restarting">3.3.1. Restarting</h4>
<div class="paragraph">
<p>You can restart the cluster at any time via <a href="#fabric8:cluster-start"><strong>fabric8:cluster-start</strong></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-start</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once restarted all the images, resources and pods should come back</p>
</div>
</div>
<div class="sect3">
<h4 id="deleting">3.3.2. Deleting</h4>
<div class="paragraph">
<p>If you wish to destroy the cluster VM and all the data inside it then you can pass the <code>fabric8.cluster.delete</code> parameter with a value of <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:cluster-stop -Dfabric8.cluster.delete=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:run">3.4. <strong>fabric8:run</strong></h3>
<div class="paragraph">
<p>This goal builds your application (generating the docker image and kubernetes manifest), deploys it on the current kubernetes cluster then tails the logs of the first pod that starts until you hit <code>Ctrl+C</code> then the application is stopped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>So this goal feels very much like the <code>run</code> goal in other maven plugins like spring-boot, tomcat, jetty, wildfly etc.</p>
</div>
<div class="paragraph">
<p>You can think of this goal as being similar to performing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:deploy
mvn fabric8:logs
...
^C
mvn fabric8:stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to <a href="#fabric8:undeploy"><strong>fabric8:undeploy</strong></a> on the <code>Ctrl+C</code> keypress you can pass in the <code>fabric8.onExit</code> goal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:run -Dfabric8.onExit=undeploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer Ctrl-C to just terminate the log tailing but leave your app running you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:run -Dfabric8.onExit=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Though its maybe just simpler to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:deploy fabric8:log</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> that you must have the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> and <a href="#fabric8:build"><strong>fabric8:build</strong></a> goals bound to your executions in your pom.xml. e.g. like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>

  <span class="comment">&lt;!-- Connect fabric8:resource, fabric8:build and fabric8:helm to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>fabric8<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:deploy">3.5. <strong>fabric8:deploy</strong></h3>
<div class="paragraph">
<p>This is the main goal for building your docker image, generating the kubernetes resources and deploying them into the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Effectively this builds your project then invokes these goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fabric8:build"><strong>fabric8:build</strong></a></p>
</li>
<li>
<p><a href="#fabric8:resource-apply"><strong>fabric8:resource-apply</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note</strong> that you must have the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> and <a href="#fabric8:build"><strong>fabric8:build</strong></a> goals bound to your executions in your pom.xml. e.g. like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>

  <span class="comment">&lt;!-- Connect fabric8:resource, fabric8:build and fabric8:helm to lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>fabric8<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
         <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:undeploy">3.6. <strong>fabric8:undeploy</strong></h3>
<div class="paragraph">
<p>This goal is for deleting the kubernetes resources that you deployed via the  <a href="#fabric8:run"><strong>fabric8:run</strong></a> or <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a> goals</p>
</div>
<div class="paragraph">
<p>It iterates through all the resources generated by the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal and deletes them from your current kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:undeploy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:start">3.7. <strong>fabric8:start</strong></h3>
<div class="paragraph">
<p>This goal starts the app that you deployed via the <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a> goal and then subsequently stopped via <a href="#fabric8:stop"><strong>fabric8:stop</strong></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:start</code></pre>
</div>
</div>
<div class="paragraph">
<p>This goal iterates through all scaleable resources generated by the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal and scales them to a <em>replica count</em> of`1` so that by the time this goal completes there should be a single running pod of this app.</p>
</div>
<div class="sect3">
<h4 id="scaling">3.7.1. Scaling</h4>
<div class="paragraph">
<p>You can also use the <code>fabric8:start</code> goal to scale the number of pods running your application via passing the <code>fabric8.replicas</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:start  -Dfabric8.replicas=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the above you should see 2 pods running for your application.</p>
</div>
<div class="paragraph">
<p>From the command line you can use the <code>kubectl</code> binary to watch pods come and go via the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">kubectl get pod -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-w</code> flag watches the resource and keeps updating the console as things change. Leaving off the <code>-w</code> just lists the current pods only then <code>kubect</code> terminates.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:stop">3.8. <strong>fabric8:stop</strong></h3>
<div class="paragraph">
<p>This goal stops the app that you deployed via the <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a> goal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>This goal iterates through all scaleable resources generated by the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal and scales them to a <em>replica count</em> of <code>0</code> so that by the time this goal completes there are no running pods for this app.</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:log">3.9. <strong>fabric8:log</strong></h3>
<div class="paragraph">
<p>This goal tails the log of the app that you deployed via the <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a> goal</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:log</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then terminate the output by hitting <code>Ctrl+C</code></p>
</div>
<div class="paragraph">
<p>If you wish to get the log of the app and then terminate immediately then try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:log -Dfabric8.log.follow=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lets you pipe the output into grep or some other tool</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:log -Dfabric8.log.follow=false | grep Exception</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:debug">3.10. <strong>fabric8:debug</strong></h3>
<div class="paragraph">
<p>This goal enables debugging in your Java app and then port forwards from localhost to the latest running pod of your app so that you can easily debug your app from your Java IDE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then follow the on screen instructions.</p>
</div>
<div class="paragraph">
<p>The default debug port is <code>5005</code>. If you wish to change the local port to use for debugging then pass in the <code>fabric8.debug.port</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:debug -Dfabric8.debug.port=8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your IDE you start a Remote debug execution using this remote port using localhost and you should be able to set breakpoints and step through your code.</p>
</div>
<div class="paragraph">
<p>This lets you debug your apps while they are running inside a Kubernetes cluster - for example if you wish to debug a REST endpoint while another pod is invoking it.</p>
</div>
<div class="paragraph">
<p>Debug is enabled via the <code>JAVA_ENABLE_DEBUG</code> environment variable being set to <code>true</code>. This environment variable is used for all the standard Java docker images used by Spring Boot, flat classpath and executable JAR projects and Wildfly Swarm. If you use your own custom docker base image you may wish to also respect this environment variable too to enable debugging.</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:import">3.11. <strong>fabric8:import</strong></h3>
<div class="paragraph">
<p>This goal imports the current project into the [fabric8 console] so that you can browse the source code via the web interface and associate a [Continuous Delivery] pipeline with the project to start automatic Continuous Deployment.</p>
</div>
<div class="paragraph">
<p>If you have a project on the file system then type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:import</code></pre>
</div>
</div>
<div class="paragraph">
<p>This goal assumes you have already enabled the <code>fabric8 maven plugin</code>. If you have not done so already then invoke the <a href="#fabric8:setup"><strong>fabric8:setup</strong></a> goal first.</p>
</div>
<div class="paragraph">
<p>If no git repository exists yet for the current project then a new git repository will be created and the current code pushed into it so that it can then be built with Jenkins.</p>
</div>
<div class="paragraph">
<p>If the current project is a git clone from a remote repository then this goal will also try to setup a <code>Secret</code> in kubernetes to keep track of the user name and password/access code or in the case of SSH protocol with git the SSH key pairs.</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:resource">3.12. <strong>fabric8:resource</strong></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is chapter is incomplete, but there is work in progress.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="resource-labels-annotations">3.12.1. Labels and Annotations</h4>
<div class="paragraph">
<p>Labels and annotations can be easily added to any resource object. This is best explained by an example.</p>
</div>
<div class="listingblock">
<div class="title">Example for label and annotations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  ...
  <span class="tag">&lt;configuration&gt;</span>
    ...
    <span class="tag">&lt;resources&gt;</span>
      <span class="tag">&lt;labels&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;all&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="tag">&lt;organisation&gt;</span>unesco<span class="tag">&lt;/organisation&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;/all&gt;</span>
        <span class="tag">&lt;service&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
          <span class="tag">&lt;persistent&gt;</span>true<span class="tag">&lt;/persistent&gt;</span>
          <span class="tag">&lt;database&gt;</span>mysql<span class="tag">&lt;/dabatabase&gt;</span>
        <span class="tag">&lt;/service&gt;</span>
        <span class="tag">&lt;replicaSet&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
          ...
        <span class="tag">&lt;/replicaSet&gt;</span>
        <span class="tag">&lt;pod&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
          ...
        <span class="tag">&lt;/pod&gt;</span>
        <span class="tag">&lt;deployment&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
          ...
        <span class="tag">&lt;/deployment&gt;</span>
      <span class="tag">&lt;/labels&gt;</span>

      <span class="tag">&lt;annotations&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
         ...
      <span class="tag">&lt;/annotations&gt;</span>
    <span class="tag">&lt;/resource&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>&lt;labels&gt;</code> section with <code>&lt;resources&gt;</code> contains labels which should be applied to objects of various kinds</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within <code>&lt;all&gt;</code> labels which should be applied to <strong>every</strong> object can be specified</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>&lt;service&gt;</code> labels are used to label services</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>&lt;replicaSet&gt;</code> labels are for replica set and replication controller</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>&lt;pod&gt;</code> holds lables for pod specifications in replication controller, replica sets and deployments</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>&lt;deployment&gt;</code> is for labels on deployments (kubernetes) and deployment configs (openshift)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The subelements are also available for specifying annotations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Labels and annotations can be specified in free form as a map. In this map the element name is the name of the label or annotation respectively, whereas the content is the value to set.</p>
</div>
<div class="paragraph">
<p>The following subelements are possible for <code>&lt;labels&gt;</code> and <code>&lt;annotations&gt;</code> :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Label and annotation configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All entries specified in the <code>&lt;all&gt;</code> sections are applied to all resource objects created. This also implies build object like image stream and build configs which are create implicitely for an <a href="#build-openshift">OpenShift build</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deployment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Deployment</code> (for Kubernetes) and <code>DeploymentConfig</code> (for OpenShift) objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pod</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied pod specification as used in <code>ReplicationController</code>,  <code>ReplicaSets</code>, <code>Deployments</code> and <code>DeploymentConfigs</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>replicaSet</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>ReplicaSet</code> and <code>ReplicationController</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels and annotations applied to <code>Service</code> objects.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:resource-apply">3.13. <strong>fabric8:resource-apply</strong></h3>
<div class="paragraph">
<p>This goal will generate the kubernetes resources via the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal and apply them into the current kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:resource-apply</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its usually simpler to just use the <a href="#fabric8:deploy"><strong>fabric8:deploy</strong></a> goal which performs a build, creates the docker image and runs <code>fabric8:resource-apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>However if you have built your code and docker image but find some issue with the generated manifests; you can update the configuration of the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal in your <code>pom.xml</code> or modify the YAML files in <code>src/main/fabric8</code> and then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:resource-apply</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will skip running unit tests and generating the docker build via <a href="#fabric8:build"><strong>fabric8:build</strong></a> but will only regenerate the manifests and apply them. This can help speed up the round trip time when fixing up resource generation issues.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> to use this goal you must have the <a href="#fabric8:resource"><strong>fabric8:resource</strong></a> goal bound to your executions in your pom.xml. e.g. like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.1.42<span class="tag">&lt;/version&gt;</span>

  <span class="comment">&lt;!-- Connect fabric8:resource to the lifecycle phases --&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
       <span class="tag">&lt;id&gt;</span>fabric8<span class="tag">&lt;/id&gt;</span>
       <span class="tag">&lt;goals&gt;</span>
         <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
       <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:build">3.14. <strong>fabric8:build</strong></h3>
<div class="paragraph">
<p>This goal is for building Docker images. Images can be build in two ways which depend on the <code>mode</code> (property: <code>fabric8.mode</code>). This mode can have be either <code>kubernetes</code> for a standard Docker build (the default) or <code>openshift</code> for an OpenShift build.</p>
</div>
<div class="paragraph">
<p>By default the mode is set to <code>auto</code>. In this case the plugin tries to detect which kind of build should be performed by contaction the API server. If this fails or if no cluster access is conigured e.g. with <code>oc login</code> then the mode is set to <code>kubernetes</code>.</p>
</div>
<div class="sect3">
<h4 id="build-kubernetes">3.14.1. Kubernetes Build</h4>
<div class="paragraph">
<p>If the mode is set to <code>kubernetes</code> then a normal Docker build is performed. The connection configuration to access the Docker daemon is described in <a href="#access-configuration">Access Configuration</a>.</p>
</div>
<div class="paragraph">
<p>In order to make the generated images available to the Kubernetes cluster the generated images need to be pushed to a registry with the goal <a href="#fabric8:push"><strong>fabric8:push</strong></a>. This is not necessary for single node clusters, though as their is no need to distribute images.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-openshift">3.14.2. OpenShift Build</h4>
<div class="paragraph">
<p>For the mode <code>openshift</code> OpenShift specific <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html">Builds</a> can be performed. These are so called <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html">Binary Source</a> builds ("binary builds" in short), where the data specified with the <a href="#build-configuration">build configuration</a>  is send directly to OpenShift as a binary archive.</p>
</div>
<div class="paragraph">
<p>There are two kind of binary builds supporte by this plugin, which can be selected with the configuration option <code>buildStrategy</code> (property <code>fabric8.build.strategy</code>)</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Build Strategies</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>buildStrategy</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s2i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#source-build">Source-to-Image</a> (S2I) build strategy uses so called builder images for creating new application images from binary build data. The builder image to use is taken from the base image configuration specified with <a href="#build-config-from">from</a> in the image build configuration. See below for a list of builder images which can be used with this plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#docker-build">Docker Build</a> is similar to a normal Docker build except that it is done by the OpenShift cluster and not by a Docker daemon. In addition this build pushes the generated image to the OpenShift internal registry so that it is accessbile in the whole cluster.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Both build strategies update an <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#image-streams">Image Stream</a> after the image creation.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.openshift.com/enterprise/latest/dev_guide/builds.html#defining-a-buildconfig">Build Config</a> and <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#image-streams">Image streams</a> can be managed by this plugin. If they do not exist, they will be automatically created by <code>fabric8:build</code>. If they do already exist, they are reused, except when the configuration option <code>buildRecreate</code> (property <code>fabric8.build.recreate</code>) is set to a value as described in <a href="#build-goal-configuration">Configuration</a>. Also if the provided build strategy is different than for the existing build configuration, the Build Config is edited to reflect the new type (which in turn removes all build associated with the previous build).</p>
</div>
<div class="paragraph">
<p>This image stream created can then be referenced directly from a <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/deployments.html#deployments-and-deployment-configurations">Deployment Configuration</a> objects created by <a href="#fabric8:resource"><strong>fabric8:resource</strong></a>.</p>
</div>
<div class="paragraph">
<p>In order to be able to to create these OpenShift resource objects access to an OpenShift installation is required. The access parameters are described in <a href="#access-configuration">Access Configuration</a>.</p>
</div>
<div class="paragraph">
<p>Regardless which build mode is used, the images are configured in the same way.</p>
</div>
<div class="paragraph">
<p>The configuration consists of two parts: A global section which defines the overall behaviour of this plugin. And a <code>&lt;images&gt;</code> section which defines how the one or more images should be build.</p>
</div>
<div class="paragraph">
<p>Many of the options below are relevant for the <a href="#build-kubernetes">Kubernetes Workflow</a> or the <a href="#build-openshift">OpenShift Workflow</a> with Docker builds as they influence how the Docker image is build.</p>
</div>
<div class="paragraph">
<p>For an S2I binary build mostly the <a href="#build-assembly">Assembly</a> is relevant because it depends on the buider image how to interpret the content of the uploaded <code>docker.tar</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-goal-configuration">3.14.3. Configuration</h4>
<div class="paragraph">
<p>The following sections describe the usual configuration, which is similar to the build configuration used in the <a href="https://dmp.fabric8.io">docker-maven-plugin</a>.</p>
</div>
<div class="paragraph">
<p>In addition a more automatic way for creating predefined build configuration can be performed with so called <a href="#generators">Generators</a>. Generators are very flexibel and can be easily created. These are described in an extra <a href="#generators">section</a>.</p>
</div>
<div class="paragraph">
<p>Global configuration parameters specify overall behavior common for all images to build. Some of the configuration options are shared with other goals.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Global configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>apiVersion</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this variable if you are using an older version of docker not compatible with the current default use to communicate with the server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.apiVersion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>authConfig</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication information when pulling from or pushing to Docker registry. There is a dedicated section <a href="#authentication">Authentication</a> for how doing security.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>autoPull</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Decide how to pull missing base images or images to start:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>on</code> : Automatic download any missing images (default)</p>
</li>
<li>
<p><code>off</code> : Automatic pulling is switched off</p>
</li>
<li>
<p><code>always</code> : Pull images always even when they are already exist locally</p>
</li>
<li>
<p><code>once</code> : For multi-module builds images are only checked once and pulled for the whole build.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.autoPull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildRecreate</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>If the effective <a href="#build-mode">mode</a> is <code>openshift</code> then this option decides how the OpenShift resource objects associated with the build should be treated when they already exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>buildConfig</code> or <code>bc</code> : Only the BuildConfig is recreated</p>
</li>
<li>
<p><code>imageStream</code> or <code>is</code> : Only the ImageStream is recreated</p>
</li>
<li>
<p><code>all</code> : Both, BuildConfig and ImageStream are recreated</p>
</li>
<li>
<p><code>none</code> : Neither BuildConfig nor ImageStream is recreated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default is <code>none</code>. If you provide the property without value then <code>all</code> is assumed, so everything gets recreated.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.build.recreate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildStrategy</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>If the effective <a href="#build-mode">mode</a> is <code>openshift</code> then this option sets the build strategy. This can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>s2i</code> for a <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#source-build">Source-to-Image build</a> with a binary source</p>
</li>
<li>
<p><code>docker</code> for a <a href="https://docs.openshift.com/enterprise/latest/architecture/core_concepts/builds_and_image_streams.html#docker-build">Docker build</a> with a binary source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default S2I is used.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.buildStrategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>certPath</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to SSL certificate when SSL is used for communicating with the Docker daemon. These certificates are normally stored in <code>~/.docker/</code>. With this configuration the path can be set explicitly. If not set, the fallback is first taken from the environment variable <code>DOCKER_CERT_PATH</code> and then as last resort <code>~/.docker/</code>. The keys in this are expected with it standard names <code>ca.pem</code>, <code>cert.pem</code> and <code>key.pem</code>. Please refer to the <a href="https://docs.docker.com/articles/https">Docker documentation</a> for more information about SSL security with Docker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.certPath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerHost</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The URL of the Docker Daemon. If this configuration option is not given, then the optional <code>&lt;machine&gt;</code> configuration section is consulted. The scheme of the URL can be either given directly as <code>http</code> or <code>https</code>
depending on whether plain HTTP communication is enabled or SSL should
be used. Alternatively the scheme could be <code>tcp</code> in which case the
protocol is determined via the IANA assigned port: 2375 for <code>http</code>
and 2376 for <code>https</code>. Finally, Unix sockets are supported by using
the scheme <code>unix</code> together with the filesystem path to the unix socket.
The discovery sequence used by the docker-maven-plugin to determine
the URL is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>value of <strong>dockerHost</strong> (<code>docker.host</code>)</p>
</li>
<li>
<p>the Docker host associated with the docker-machine named in <code>&lt;machine&gt;</code>, i.e. the <code>DOCKER_HOST</code> from <code>docker-machine env</code>. See <a href="#docker-machine">below</a> for more information about Docker machine support.</p>
</li>
<li>
<p>the value of the environment variable <code>DOCKER_HOST</code>.</p>
</li>
<li>
<p><code>unix:///var/run/docker.sock</code> if it is a readable socket.</p>
</li>
</ol>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.host</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>image</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In order to temporarily restrict the operation of plugin goals this configuration option can be used. Typically this will be set via the system property <code>docker.image</code> when Maven is called. The value can be a single image name (either its alias or full name) or it can be a comma separated list with multiple image names. Any name which doesn&#8217;t refer an image in the configuration will be ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.image</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>machine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker machine configuration. See <a href="#docker-machine">Docker Machine</a> for possible values</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-mode"></a> <strong>mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The build mode which can be</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubernetes</code> : A Docker image will be created by calling a Docker daemon. See <a href="#build-kubernetes">Kubernetes Build</a> for details.</p>
</li>
<li>
<p><code>openshift</code> : An OpenShift Build will be triggered, which can be either a <em>Docker binary build</em> or a <em>S2I binary build</em>, depending on the configuration <code>buildStrategy</code>. See <a href="#build-openshift">OpenShift Build</a> for details.</p>
</li>
<li>
<p><code>auto</code> : The plugin tries to detect the mode by contacting the configured cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>auto</code> is the default. (<em>Because of technical reasons, "kubernetes" is currently the default, but will change to "auto" eventually</em>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.mode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maxConnections</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of parallel connections are allowed to be opened to the Docker Host. For parsing log output, a connection needs to be kept open (as well for the wait features), so don&#8217;t put that number to low. Default is 100 which should be suitable for most of the cases.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.maxConnections</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>namespace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace to use when accessing Kubernetes or OpenShift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.namespace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default output directory to be used by this plugin. The default value is <code>target/docker</code> and is only used for the goal <code>fabric8:build</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.target.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>portPropertyFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global property file into which the mapped properties should be written to. The format of this file and its purpose are also described in <a href="#start-port-mapping">Port Mapping</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to which contains enricher and generators configuration. See <a href="#profiles">Profiles</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.profile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify globally a registry to use for pulling and pushing images. See <a href="#registry">Registry handling</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>resourceDir</strong>*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where fabric8 resources are stored. This is also the directory where a custom profile is looked up</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.resourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With this parameter the execution of this plugin can be skipped completely.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipBuild</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set not images will be build (which implies also <em>skip.tag</em>) with <code>fabric8:build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.build</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipBuildPom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set the build step will be skipped for modules of type <code>pom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.build.pom</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipTag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> this plugin won&#8217;t add any tags to images that have been built with <code>fabric8:build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.tag</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipMachine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip using docker machine in any case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.machine</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sourceDirectory</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default directory that contains the assembly descriptor(s) used by the plugin. The default value is <code>src/main/docker</code>. This option is only relevant for the <code>fabric8:build</code> goal.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.source.dir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>verbose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean attribute for switching on verbose output like the build steps when doing a Docker build. Default is <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.verbose</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="image-configuration">3.14.4. Image Configuration</h4>
<div class="paragraph">
<p>The configuration how images should be created a defined in a dedicated <code>&lt;images&gt;</code> sections. These are specified for each image within the <code>&lt;images&gt;</code> element of the configuration with one <code>&lt;image&gt;</code> element per image to use.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;image&gt;</code> element can contain the following sub elements:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Image Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each <code>&lt;image&gt;</code> configuration has a mandatory, unique docker
repository <em>name</em>. This can include registry and tag parts, but also placeholder parameters. See below for a detailed explanation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shortcut name for an image which can be used for
identifying the image within this configuration. This is used when
linking images together or for specifying it with the global <strong>image</strong> configuration element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>registry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry to use for this image. If the <code>name</code> already contains a registry this takes precedence. See <a href="#registry">Registry handling</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>build</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element which contains all the configuration aspects when doing a <a href="#fabric8:build"><strong>fabric8:build</strong></a>. This element can be omitted if the image is only pulled from a registry e.g. as support for integration tests like database images.</p></td>
</tr>
</tbody>
</table>
<div id="image-name-placeholders" class="paragraph">
<div class="title">Name placeholders</div>
<p>When specifying the name you can use several placeholders which are replaced during runtime by this plugin. In addition you can use regular Maven properties which are resolved by Maven itself.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Placeholders</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%g</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The last part of the Maven group name, sanitized so that it can be used as username on GitHub. Only the part after the last dot is used. E.g. for a group id <code>io.fabric8</code> this placeholder would insert <code>fabric8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%a</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sanitized version of the artefact id so that it can be used as part of an Docker image name. I.e. it is converted to all lower case (as required by Docker)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%v</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The project version. Synonym to <code>${project.version}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%l</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the project version ends with <code>-SNAPSHOT</code> then this placeholder is <code>latest</code>, otherwise its the full version (same as <code>%v</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>%t</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the project version ends with <code>-SNAPSHOT</code> this placeholder resolves to <code>snapshot-&lt;timestamp&gt;</code> where timestamp has the date format <code>yyMMdd-HHmmss-SSSS</code> (eg <code>snapshot-</code>). This feature is especially useful during development in oder to avoid conflicts when images are to be updated which are still in use. You need to take care yourself of cleaning up old images afterwards, though.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>&lt;build&gt;</code> section is mandatory and is explained in <a href="#build-configuration">below</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example for &lt;image&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  ....
  <span class="tag">&lt;images&gt;</span>
    <span class="tag">&lt;image&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;name&gt;</span>%g/docker-demo:0.1<span class="tag">&lt;/name&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;alias&gt;</span>service<span class="tag">&lt;/alias&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;build&gt;</span>....<span class="tag">&lt;/build&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      ....
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>One or more <code>&lt;image&gt;`</code> definitions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Docker image name used when creating the image.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An alias which can be used in other parts of the plugin to reference to this image. This alias must be unique.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A <code>&lt;build&gt;</code> section as described in <a href="#buid-configuration">Build Configuration</a></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build-configuration">3.14.5. Build Configuration</h4>
<div id="build-overview" class="paragraph">
<p>There are two different modes how Images can be built:</p>
</div>
<div class="paragraph">
<div class="title">Inline plugin configuration</div>
<p>With an inline plugin configuration all information required to build the image is contained in the plugin configuration. By default its the standard XML based configuration for the plugin but can be switched to a property based configuration syntax as described in the section <a href="#external-configuration">External configuration</a>. The XML configuration syntax is recommended because of its more structured and typed nature.</p>
</div>
<div class="paragraph">
<p>When using this mode, the Dockerfile is created on the fly with all instructions extracted from the configuration given.</p>
</div>
<div id="external-dockerfile" class="paragraph">
<div class="title">External Dockerfile</div>
<p>Alternatively an external Dockerfile template can be used. This mode is switch on by using one of these two configuration options within
the <code>&lt;build&gt;</code> configuration section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>dockerFileDir</strong> specifies a directory containing a <code>Dockerfile</code> that will be used to create the image.</p>
</li>
<li>
<p><strong>dockerFile</strong> specifies a specific Dockerfile. The <code>dockerFileDir</code> is set to the directory containing the file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>dockerFileDir</code> is a relative path looked up in <code>${project.basedir}/src/main/docker</code>. You can make easily an absolute path by prefixing with <code>${project.basedir}</code>.</p>
</div>
<div class="paragraph">
<p>Any additional files located in the <code>dockerFileDir</code> directory will also be added to the build context as well as any files specified by an assembly. However, you still need to insert <code>ADD</code> or <code>COPY</code> directives yourself into the Dockerfile.</p>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.maven-dockerignore</code> (or alternatively, a <code>.maven-dockerexclude</code> file), then it is used for excluding files for the build. Each line in this file is treated as an <a href="http://ant.apache.org/manual/Types/fileset.html">FileSet exclude pattern</a> as used by the <a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a>. It is similar to <code>.dockerignore</code> when using Docker but has a slightly different syntax (hence the different name).</p>
</div>
<div class="paragraph">
<p>If this directory contains a <code>.maven-dockerinclude</code> file, then it is used for including only those files for the build. Each line in this file is also treated as an <a href="http://ant.apache.org/manual/Types/fileset.html">FileSet exclude pattern</a> as used by the <a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a>.</p>
</div>
<div class="paragraph">
<p>Except for the <a href="#build-assembly">assembly configuration</a> all other configuration options are ignored for now.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>For the future it is planned to introduce special keywords lile <code>DMP_ADD_ASSEMBLY</code> which can be used in the Dockerfile template to placing the configuration resulting from the additional configuration.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example uses a Dockerfile in the directory
<code>src/main/docker/demo</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
 <span class="tag">&lt;configuration&gt;</span>
   <span class="tag">&lt;images&gt;</span>
     <span class="tag">&lt;image&gt;</span>
       <span class="tag">&lt;name&gt;</span>user/demo<span class="tag">&lt;/name&gt;</span>
       <span class="tag">&lt;build&gt;</span>
         <span class="tag">&lt;dockerFileDir&gt;</span>demo<span class="tag">&lt;/dockerFileDir&gt;</span>
       <span class="tag">&lt;/build&gt;</span>
     <span class="tag">&lt;/image&gt;</span>
   <span class="tag">&lt;/images&gt;</span>
 <span class="tag">&lt;/configuration&gt;</span>
 ...
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All build relevant configuration is contained in the <code>&lt;build&gt;</code> section
of an image configuration. In addition to <code>&lt;dockerFileDir&gt;</code> and
<code>&lt;dockerFile&gt;</code> the following configuration options are available:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Build configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>assembly</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specifies the assembly configuration as described in <a href="#build-assembly">Build Assembly</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>buildArgs</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map specifying the value of <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build args</a>
which should be used when building the image with an external Dockerfile which uses build arguments. The key-value syntax is the same as when defining Maven properties (or <code>labels</code> or <code>env</code>).
This argument is ignored when no external Dockerfile is used. Build args can also be specified as properties as
described in <a href="#build-buildargs">Build Args</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cleanup</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cleanup dangling (untagged) images after each build (including any containers created from them). Default is <code>try</code> which tries to remove the old image, but doesn&#8217;t fail the build if this is not possible because e.g. the image is still used by a running container. Use <code>remove</code> if you want to fail the build and <code>none</code> if no cleanup is requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nocache</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t use Docker&#8217;s build cache. This can be overwritten by setting a system property <code>docker.nocache</code> when running Maven.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cmd</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command to execute by default (i.e. if no command is provided when a container for this image is started). See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>entryPoint</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entrypoint allows you to configure a container that will run as an executable. See <a href="#misc-startup">Startup Arguments</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>env</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The environments as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="build-config-from"></a><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base image which should be used for this image. If not given this default to <code>busybox:latest</code> and is suitable for a pure data image.
In case of an <a href="#build-openshift">S2I Binary build</a> this parameter specifies the S2I Builder Image to use, which by default is <code>fabric8/s2i-java:latest</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>labels</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels  as described in <a href="#misc-env">Setting Environment Variables and Labels</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>maintainer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The author (<code>MAINTAINER</code>) field for the generated image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The exposed ports which is a list of <code>&lt;port&gt;</code> elements, one for each port to expose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>runCmds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commands to be run during the build process. It contains <strong>run</strong> elements which are passed to the shell. The run commands are inserted right after the assembly and after <strong>workdir</strong> in to the Dockerfile. This tag is not to be confused with the <code>&lt;run&gt;</code> section for this image which specifies the runtime behaviour when starting containers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optimise</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true then it will compress all the <code>runCmds</code> into a single <code>RUN</code> directive so that only one image layer is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>compression</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The compression mode how the build archive is transmitted to the docker daemon (<code>fabric8:build</code>) and how docker build archives are attached to this build as sources (<code>fabric8:source</code>). The value can be <code>none</code> (default), <code>gzip</code> or <code>bzip2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skip</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true disables building of the image. This config option is best used together with a maven property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>tags</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of additional <code>tag</code> elements with which an image is to be tagged after the build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User to which the Dockerfile should switch to the end (corresponds to the <code>USER</code> Dockerfile directive).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>volumes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <code>volume</code> elements to create a container volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>workdir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to change to when starting the container.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From this configuration this Plugin creates an in-memory Dockerfile,
copies over the assembled files and calls the Docker daemon via its
remote API.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
  <span class="tag">&lt;from&gt;</span>java:8u40<span class="tag">&lt;/from&gt;</span>
  <span class="tag">&lt;maintainer&gt;</span>john.doe@example.com<span class="tag">&lt;/maintainer&gt;</span>
  <span class="tag">&lt;tags&gt;</span>
    <span class="tag">&lt;tag&gt;</span>latest<span class="tag">&lt;/tag&gt;</span>
    <span class="tag">&lt;tag&gt;</span>${project.version}<span class="tag">&lt;/tag&gt;</span>
  <span class="tag">&lt;/tags&gt;</span>
  <span class="tag">&lt;ports&gt;</span>
    <span class="tag">&lt;port&gt;</span>8080<span class="tag">&lt;/port&gt;</span>
  <span class="tag">&lt;/ports&gt;</span>
  <span class="tag">&lt;volumes&gt;</span>
    <span class="tag">&lt;volume&gt;</span>/path/to/expose<span class="tag">&lt;/volume&gt;</span>
  <span class="tag">&lt;/volumes&gt;</span>

  <span class="tag">&lt;entryPoint&gt;</span>
    <span class="comment">&lt;!-- exec form for ENTRYPOINT --&gt;</span>
    <span class="tag">&lt;exec&gt;</span>
      <span class="tag">&lt;arg&gt;</span>java<span class="tag">&lt;/arg&gt;</span>
      <span class="tag">&lt;arg&gt;</span>-jar<span class="tag">&lt;/arg&gt;</span>
      <span class="tag">&lt;arg&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/arg&gt;</span>
    <span class="tag">&lt;/exec&gt;</span>
  <span class="tag">&lt;/entryPoint&gt;</span>

  <span class="tag">&lt;assembly&gt;</span>
    <span class="tag">&lt;mode&gt;</span>dir<span class="tag">&lt;/mode&gt;</span>
    <span class="tag">&lt;basedir&gt;</span>/opt/demo<span class="tag">&lt;/basedir&gt;</span>
    <span class="tag">&lt;descriptor&gt;</span>assembly.xml<span class="tag">&lt;/descriptor&gt;</span>
  <span class="tag">&lt;/assembly&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to see the individual build steps you can switch on <code>verbose</code> mode either by setting the property <code>docker.verbose</code> or by using <code>&lt;verbose&gt;true&lt;/verbose&gt;</code> in the <a href="#global-configuration">Global configuration</a></p>
</div>
</div>
<div class="sect3">
<h4 id="build-assembly">3.14.6. Assembly</h4>
<div class="paragraph">
<p>The <code>&lt;assembly&gt;</code> element within <code>&lt;build&gt;</code> is has an XML struture and defines how build artifacts and other files can enter the Docker image.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. Assembly Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>basedir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory under which the files and artifacts contained in the assembly will be copied within the container. The default value for this is <code>/maven</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>inline</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inlined assembly descriptor as described in <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>descriptor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to an assembly descriptor file, whose format is described  <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>descriptorRef</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias to a predefined assembly descriptor. The available aliases are also described in <a href="#build-assembly-descriptor">Assembly Descriptor</a> below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dockerFileDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory containing an external Dockerfile. _This option is deprecated, please use &lt;dockerfiledir&gt; directly in the &lt;build&gt; section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exportBasedir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification whether the <code>basedir</code> should be exported as a volume.  This value is <code>true</code> by default except in the case the <code>basedir</code> is set to the container root (<code>/</code>). It is also <code>false</code> by default when a base image is used with <code>from</code> since exporting makes no sense in this case and will waste disk space unnecessarily.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignorePermissions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification if existing file permissions should be ignored
when creating the assembly archive with a mode <code>dir</code>. This value is <code>false</code> by default. <em>This property is deprecated, use a <code>permissionMode</code> of <code>ignore</code> instead.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Mode how the how the assembled files should be collected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dir</code> : Files are simply copied (default),</p>
</li>
<li>
<p><code>tar</code> : Transfer via tar archive</p>
</li>
<li>
<p><code>tgz</code> : Transfer via compressed tar archive</p>
</li>
<li>
<p><code>zip</code> : Transfer via ZIP archive</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archive formats have the advantage that file permission can be preserved better (since the copying is independent from the underlying files systems), but might triggers internal bugs from the Maven assembler (as it has been reported in <a href="https://github.com/fabric8io/docker-maven-plugin/issues/171">#171</a>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>permissions</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Permission of the files to add:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ignore</code> to use the permission as found on files regardless on any
assembly configuration</p>
</li>
<li>
<p><code>keep</code> to respect the assembly provided permissions, <code>exec</code> for setting the executable bit on all files (required for Windows when using an assembly mode <code>dir</code>)</p>
</li>
<li>
<p><code>auto</code> to let the plugin select <code>exec</code> on Windows and <code>keep</code> on others.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>keep</code> is the default value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User and/or group under which the files should be added. The user must already exist in the base image.
</p><p class="tableblock">It has the general format <code>user[:group[:run-user]]</code>. The user and group can be given either as numeric user- and group-id or as names. The group id is optional.
</p><p class="tableblock">If a third part is given, then the build changes to user <code>root</code> before changing the ownerships, changes the ownerships and then change to user <code>run-user</code> which is then used for the final command to execute. This feature might be needed, if the base image already changed the user (e.g. to 'jboss') so that a <code>chown</code> from root to this user would fail.
</p><p class="tableblock">For example, the image <code>jboss/wildfly</code> use a "jboss" user under which all commands are executed. Adding files in Docker always happens under the UID root. These files can only be changed to "jboss" is the <code>chown</code> command is executed as root. For the following commands to be run again as "jboss" (like the final <code>standalone.sh</code>), the plugin switches back to user <code>jboss</code> (this is this "run-user") after changing the file ownership. For this example a specification of
<code>jboss:jboss:jboss</code> would be required.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the event you do not need to include any artifacts with the image, you may safely omit this element from the configuration.</p>
</div>
<div class="sect4">
<h5 id="build-assembly-descriptor">Assembly Descriptor</h5>
<div class="paragraph">
<p>With using the <code>inline</code>, <code>descriptor</code> or <code>descriptorRef</code> option
it is possible to bring local files, artifacts and dependencies into
the running Docker container. A <code>descriptor</code> points to a file
describing the data to put into an image to build. It has the same
<a href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html">format</a> as for creating assemblies with the
<a href="http://maven.apache.org/plugins/maven-assembly-plugin">maven-assembly-plugin</a> with following exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;formats&gt;</code> are ignored, the assembly will allways use a directory
when preparing the data container (i.e. the format is fixed to
<code>dir</code>)</p>
</li>
<li>
<p>The <code>&lt;id&gt;</code> is ignored since only a single assembly descriptor is
used (no need to distinguish multiple descriptors)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also you can inline the assembly description with a <code>inline</code> description
directly into the pom file. Adding the proper namespace even allows for
IDE autocompletion. As an example, refer to the profile <code>inline</code> in
the `data-jolokia-demo&#8217;s pom.xml.</p>
</div>
<div class="paragraph">
<p>Alternatively <code>descriptorRef</code> can be used with the name of a
predefined assembly descriptor. The following symbolic names can be
used for <code>descriptorRef</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Predefined Assembly Descriptors</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Assembly Reference</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>artifact-with-dependencies</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches project&#8217;s artifact and all its dependencies. Also, when a <code>classpath</code> file exists in the target directory, this will be added to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>artifact</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches only the project&#8217;s artifact but no dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>project</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attaches the whole Maven project but with out the <code>target/</code> directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>rootWar</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies the artifact as <code>ROOT.war</code> to the exposed directory. I.e. Tomcat will then deploy the war under the root context.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;images&gt;</span>
  <span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;build&gt;</span>
      <span class="tag">&lt;assembly&gt;</span>
         <span class="tag">&lt;descriptorRef&gt;</span>artifact-with-dependencies<span class="tag">&lt;/descriptorRef&gt;</span>
         .....</code></pre>
</div>
</div>
<div class="paragraph">
<p>will add the created artifact with the name <code>${project.build.finalName}.${artifact.extension}</code> and all jar dependencies in the the <code>baseDir</code> (which is <code>/maven</code> by default).</p>
</div>
<div class="paragraph">
<p>All declared files end up in the configured <code>basedir</code> (or <code>/maven</code> by default) in the created image.</p>
</div>
<div class="paragraph">
<p>If the assembly references the artifact to build with this pom, it is required that the <code>package</code> phase is included in the run. This happens either automatically when the <code>fabric8:build</code> target is called as part of a binding (e.g. is <code>fabric8:build</code> is bound to the <code>pre-integration-test</code>
phase) or it must be ensured when called on the command line:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn package fabric8:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a general restriction of the Maven lifecycle which applies also
for the <code>maven-assembly-plugin</code> itself.</p>
</div>
<div class="paragraph">
<p>In the following example a dependency from the pom.xml is included and
mapped to the name <code>jolokia.war</code>. With this configuration you will end
up with an image, based on <code>busybox</code> which has a directory <code>/maven</code>
containing a single file <code>jolokia.war</code>. This volume is also exported
automatically.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assembly&gt;</span>
  <span class="tag">&lt;dependencySets&gt;</span>
    <span class="tag">&lt;dependencySet&gt;</span>
      <span class="tag">&lt;includes&gt;</span>
        <span class="tag">&lt;include&gt;</span>org.jolokia:jolokia-war<span class="tag">&lt;/include&gt;</span>
      <span class="tag">&lt;/includes&gt;</span>
      <span class="tag">&lt;outputDirectory&gt;</span>.<span class="tag">&lt;/outputDirectory&gt;</span>
      <span class="tag">&lt;outputFileNameMapping&gt;</span>jolokia.war<span class="tag">&lt;/outputFileNameMapping&gt;</span>
    <span class="tag">&lt;/dependencySet&gt;</span>
  <span class="tag">&lt;/dependencySets&gt;</span>
<span class="tag">&lt;/assembly&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another container can now connect to the volume an 'mount' the
<code>/maven</code> directory. A container  from <code>consol/tomcat-7.0</code> will look
into <code>/maven</code> and copy over everything to <code>/opt/tomcat/webapps</code> before
starting Tomcat.</p>
</div>
<div class="paragraph">
<p>If you are using the <code>artifact</code> or <code>artifact-with-dependencies</code> descriptor, it is
possible to change the name of the final build artifact with the following:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
  <span class="tag">&lt;finalName&gt;</span>your-desired-final-name<span class="tag">&lt;/finalName&gt;</span>
  ...
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note, based upon the following documentation listed <a href="http://maven.apache.org/pom.html#BaseBuild_Element">here</a>, there is no guarantee the plugin creating your artifact will honor it in which case you will need to use a custom descriptor like above to achieve the desired naming.</p>
</div>
<div class="paragraph">
<p>Currently the <code>jar</code> and <code>war</code> plugins properly honor the usage of <code>finalName</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="misc-env">3.14.7. Environment and Labels</h4>
<div class="paragraph">
<p>When creating a container one or more environment variables can be set via configuration with the <code>env</code> parameter</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;env&gt;</span>
  <span class="tag">&lt;JAVA_HOME&gt;</span>/opt/jdk8<span class="tag">&lt;/JAVA_HOME&gt;</span>
  <span class="tag">&lt;CATALINA_OPTS&gt;</span>-Djava.security.egd=file:/dev/./urandom<span class="tag">&lt;/CATALINA_OPTS&gt;</span>
<span class="tag">&lt;/env&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you put this configuration into profiles you can easily create various test variants with a single image (e.g. by switching the JDK or whatever).</p>
</div>
<div class="paragraph">
<p>It is also possible to set the environment variables from the outside of the plugin&#8217;s configuration with the parameter <code>envPropertyFile</code>. If given, this property file is used to set the environment variables where the keys and values specify the environment variable. Environment variables specified in this file override any environment variables specified in the configuration.</p>
</div>
<div class="paragraph">
<p>Labels can be set inline the same way as environment variables:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;labels&gt;</span>
   <span class="tag">&lt;com.example.label-with-value&gt;</span>foo<span class="tag">&lt;/com.example.label-with-value&gt;</span>
   <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>${project.artifactId}<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/labels&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="misc-startup">3.14.8. Startup Arguments</h4>
<div class="paragraph">
<p>Using <code>entryPoint</code> and <code>cmd</code> it is possible to specify the <a href="https://docs.docker.com/reference/builder/#entrypoint">entry point</a>
or <a href="https://docs.docker.com/reference/builder/#cmd">cmd</a> for a container.</p>
</div>
<div class="paragraph">
<p>The difference is, that an <code>entrypoint</code> is the command that always be executed, with the <code>cmd</code> as argument. If no <code>entryPoint</code> is provided, it defaults to <code>/bin/sh -c</code> so any <code>cmd</code> given is executed with a shell. The arguments given to <code>docker run</code> are always given as arguments to the
<code>entrypoint</code>, overriding any given <code>cmd</code> option. On the other hand if no extra arguments are given to <code>docker run</code> the default <code>cmd</code> is used as argument to <code>entrypoint</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>See this <a href="http://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile">stackoverflow question</a> for a detailed explanation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A entry point or command can be specified in two alternative formats:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. Entrypoint and Command Configuration</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>shell</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell form in which the whole line is given to <code>shell -c</code> for interpretation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exec</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of arguments (with inner <code>&lt;args&gt;</code>) arguments which will be given to the <code>exec</code> call directly without any shell interpretation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Either shell or params should be specified.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
   <span class="comment">&lt;!-- shell form  --&gt;</span>
   <span class="tag">&lt;shell&gt;</span>java -jar $HOME/server.jar<span class="tag">&lt;/shell&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
   <span class="comment">&lt;!-- exec form  --&gt;</span>
   <span class="tag">&lt;exec&gt;</span>
     <span class="tag">&lt;args&gt;</span>java<span class="tag">&lt;/args&gt;</span>
     <span class="tag">&lt;args&gt;</span>-jar<span class="tag">&lt;/args&gt;</span>
     <span class="tag">&lt;args&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/args&gt;</span>
   <span class="tag">&lt;/exec&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be formulated also more dense with:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- shell form  --&gt;</span>
<span class="tag">&lt;entryPoint&gt;</span>java -jar $HOME/server.jar<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entryPoint&gt;</span>
  <span class="comment">&lt;!-- exec form  --&gt;</span>
  <span class="tag">&lt;arg&gt;</span>java<span class="tag">&lt;/arg&gt;</span>
  <span class="tag">&lt;arg&gt;</span>-jar<span class="tag">&lt;/arg&gt;</span>
  <span class="tag">&lt;arg&gt;</span>/opt/demo/server.jar<span class="tag">&lt;/arg&gt;</span>
<span class="tag">&lt;/entryPoint&gt;</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">INFO</dt>
<dd>
<p>Startup arguments are not used in S2I builds</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="build-buildargs">3.14.9. Build Args</h4>
<div class="paragraph">
<p>As described in section <a href="#build-configuration">Configuration</a> for external Dockerfiles <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables-build-arg">Docker build arg</a> can be used. In addition to the
configuration within the plugin configuration you can also use properties to specify them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set a system property when running Maven, eg.: <code>-Ddocker.buildArg.http_proxy=http://proxy:8001</code>. This is especially
useful when using predefined Docker arguments for setting proxies transparently.</p>
</li>
<li>
<p>Set a project property within the <code>pom.xml</code>, eg.:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;docker.buildArg.myBuildArg&gt;</span>myValue<span class="tag">&lt;/docker.buildArg.myBuildArg&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the system property setting will always override the project property. Also note that for all properties which are not Docker <a href="https://docs.docker.com/engine/reference/builder/#arg">predefined</a> properties, the external Dockerfile must contain an <code>ARGS</code> instruction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:push">3.15. <strong>fabric8:push</strong></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Section needs review and rearrangments
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This goal uploads images to the registry which have a <code>&lt;build&gt;</code> configuration section. The images to push can be restricted with with
the global option <code>image</code> (see <a href="#global-configuration">Global Configuration</a> for details). The registry to push is by default <code>docker.io</code> but can be specified as part of the images&#8217;s <code>name</code> name the Docker way. E.g. <code>docker.test.org:5000/data:1.5</code> will push the image <code>data</code> with tag <code>1.5</code> to the registry <code>docker.test.org</code> at port <code>5000</code>. Security information (i.e. user and password) can be specified in multiple ways as described in section <a href="#authentication">Authentication</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. Push options</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>skipPush</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code> the plugin won&#8217;t push any images that have been built.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.skip.push</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>pushRegistry</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The registry to use when pushing the image. See <a href="#registry">Registry Handling</a> for
more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.push.registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>retries</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often should a push be retried before giving up. This useful for flaky registries which tend to return 500 error codes from time to time. The default is 0 which means no retry at all.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker.push.retries</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="fabric8:install">3.16. <strong>fabric8:install</strong></h3>
<div class="paragraph">
<p>Ensures that the fabric8 binaries are installed on the current machine such as <a href="https://github.com/fabric8io/gofabric8/">gofabric8</a> and for kubernetes: <a href="http://kubernetes.io/docs/user-guide/kubectl-overview/">kubectl</a> and <a href="https://github.com/kubernetes/minikube">minikube</a> or for OpenShift: <a href="https://docs.openshift.com/enterprise/latest/cli_reference/basic_cli_operations.html">oc</a> and <a href="https://github.com/jimmidyson/minishift">minishift</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:install</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is to just run the <a href="#fabric8:cluster-start"><strong>fabric8:cluster-start</strong></a> goal to install the binaries and start a local cluster</p>
</div>
<div class="paragraph">
<p>By default the binaries are installed in <code>~/.fabric8/bin</code></p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:helm">3.17. <strong>fabric8:helm</strong></h3>
<div class="paragraph">
<p>This goal is for creating <a href="https://github.com/kubernetes/helm/blob/master/docs/charts.md#the-chart-file-structure">Helm charts</a> for your Maven project so that you can install, update or delete your app in Kubernetes using <a href="https://github.com/kubernetes/helm">Helm</a>.</p>
</div>
<div class="paragraph">
<p>For creating a Helm chart you simply call <code>fabric8:helm</code> goal on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn fabric8:resource fabric8:helm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fabric8:resource</code> goal is required to create the resource descriptors which are included in the Helm chart. If you have already built the resource then you can ommit this goal.</p>
</div>
<div class="paragraph">
<p>The configuration happens in a <code>&lt;helm&gt;</code> section within the plugin&#8217;s configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Helm configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;helm&gt;</span>
      <span class="tag">&lt;chart&gt;</span>Jenkins<span class="tag">&lt;/chart&gt;</span>
      <span class="tag">&lt;keywords&gt;</span>ci,cd,server<span class="tag">&lt;/keywords&gt;</span>
    <span class="tag">&lt;/helm&gt;</span>
    ...
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration section know the following subelements in order to configure your Helm chart.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. Helm configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 71.4285%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>chart</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Chart name, which is <code>${project.artifactId}</code> if not given.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.helm.chart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For which platform to generate the chart. By default this is <code>kubernetes</code>, but can be also <code>openshift</code> for using OpenShift specific resources in the chart. <em>Please note that there is no OpenShift support yet for charts, so this is experimental</em>. You can also add both values as a comma separated list.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.helm.type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sourceDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the resource descriptors generated with <code>fabric8:resource</code>. By default this is <code>${basedir}/target/classes/META-INF/fabric8</code>, which is also the output directory used by <code>fabric8:resource</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.helm.sourceDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>outputDir</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to create the the Helm chart, which is <code>${basedir}/target/fabric8/helm</code> by default for Kubernetes (and <code>${basedir}/target/fabric8/helmshift</code> for OpenShift).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.helm.outputDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>keywords</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of keywords to add to the chart</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>engine</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The template engine to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In a next step you can install this via the <a href="https://github.com/kubernetes/helm/releases">helm command line tool</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">helm install target/fabric8/helm/kubernetes</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add the <code>helm</code> goal to your project so that it is automatically executed just add the <code>helm</code> goal to the <code>executions</code> section of the <code>fabric8-maven-plugin</code> section of your <code>pom.xml</code>.</p>
</div>
<div class="listingblock">
<div class="title">Add helm goal</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>

  <span class="comment">&lt;!-- ... --&gt;</span>

  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>deploy<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition this goal will also create a tar-archive below <code>${basedir}/target</code> which contains the chart with its template. This tar is added as an aritfact with classifier <code>helm</code> to the build (<code>helmshift</code> for the OpenShift mode).</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:helm-index">3.18. <strong>fabric8:helm-index</strong></h3>
<div class="paragraph">
<p>Generates a Manifest index file by querying a maven repository to find all the Kubernetes and OpenShift manifests available and their releases.</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:app-catalog">3.19. <strong>fabric8:app-catalog</strong></h3>
<div class="paragraph">
<p>Generates an App Catalog for kubernetes and openshift</p>
</div>
<div class="paragraph">
<p>On OpenShift this just means getting the <code>openshift.yml</code> and if its not a <code>Template</code> wrapping it in an empty <code>Template</code>.</p>
</div>
<div class="paragraph">
<p>For Kubernetes this means checking if there is a kubernetes <code>template.yaml</code> and if so wrapping that in a <code>ConfigMap</code> otherwise it uses the regular <code>kubernetes.yaml</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="fabric8:distro">3.20. <strong>fabric8:distro</strong></h3>
<div class="paragraph">
<p>Generates a tarball of all the dependent kubernetes and openshift templates</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generators">4. Generators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usual way to define Docker images is with the plugin configuration as explained in <a href="#fabric8:build"><strong>fabric8:build</strong></a>. This can either be done completly within the pom.xml or by refering to an external Dockerfile. Since fabric8-maven-plugin includes our <a href="https://github.com/fabric8io/docker-maven-plugin">docker-maven-plugin</a> the way how images are built is identical.</p>
</div>
<div class="paragraph">
<p>However, this plugin provides an additional route for defining image configurations. This is done by so called <em>Generators</em>. A generator is a Java component providing an auto-detection mechanism for certain build type like a Spring Boot build or a plain Java build. As soon as a generator detects that it is applicable it will be called with the list of images configured in the pom.xml. Typically a generator only creates dynamically an image configuration if this list is empty. But a generator is free to also add new images to an existing list or even change the current image list.</p>
</div>
<div class="paragraph">
<p>You can easily create your own generator as explained in <a href="#generators-api">Generator API</a>. This section however will focus on existing generators and how you can configure them.</p>
</div>
<div class="paragraph">
<p>By default, this plugin includes already a set of generators,  which are explained in detail below. These generators are enabled by default, but you can easil disable them or only select a certain set of generators. Each generator has a <em>name</em>, which is unique for a generator.</p>
</div>
<div class="paragraph">
<p>The generator configuration is embedded in a <code>&lt;generator&gt;</code> configuration section:</p>
</div>
<div id="generator-example" class="listingblock">
<div class="title">Example for a generator configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  ....
  <span class="tag">&lt;configuration&gt;</span>
    ....
    <span class="tag">&lt;generator&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;includes&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;include&gt;</span>spring-boot<span class="tag">&lt;/include&gt;</span>
      <span class="tag">&lt;/includes&gt;</span>
      <span class="tag">&lt;config&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tag">&lt;spring-boot&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
          <span class="tag">&lt;alias&gt;</span>ping<span class="tag">&lt;/alias&gt;</span>
        <span class="tag">&lt;/spring-boot&gt;</span>
      <span class="tag">&lt;/config&gt;</span>
    <span class="tag">&lt;/generator&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start of generators' configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generators can be included and excluded. Includes have precedence, and the generators are called in the given order.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuration for individual generators.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The config is a map of supported config values. Each section is embedded in a tag named after the generator.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generators can be configured with a <code>&lt;generator&gt;</code> section. The following sub-elements are supported.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. Generator configuration</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;includes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one ore more <code>&lt;include&gt;</code> elements with generator names which should be included. If given, only this list of generators are included in this given order. The order is important because by default only the first matching generator kicks in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;excludes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>&lt;exclude&gt;</code> elements with generator names to exclude. This mean all detected generators are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all generators. Each generator support a specific set of configuration values as described in the documentation. The subelements of this section are generator names to configure. E.g. for generator <code>spring-boot</code>, the sub-element is called <code>&lt;spring-boot&gt;</code>. This element then holds the specific generator configuration like <code>&lt;name&gt;</code> for specifying the final image name. See above for an example.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Beside the specifying generator configuration in the plugin&#8217;s configuration it can be set with properties, too:</p>
</div>
<div class="listingblock">
<div class="title">Example generator property config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Dfabric8.generator.spring-boot.alias=&quot;myapp&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general scheme is a prefix <code>fabric8.generator.</code> followed by the unique generator name and then the generator specific key.</p>
</div>
<div class="paragraph">
<p>fabric8-maven-plugin comes with a set of default generators which are described in the next secion <a href="#generators-fabric8">Fabric8 Generators</a>. These are enabled by default. In addition, custom generators can be easily added by simply declaring a compile scoped dependency in the <code>pom.xml</code>. This and how a generator can be implemented is described in <a href="#generators-api">Generator API</a>.</p>
</div>
<div class="sect2">
<h3 id="generators-default">4.1. Default Generators</h3>
<div class="paragraph">
<p>All default generators examine the build information for certain aspect and generate a Docker build information on the fly. They can be configured to a certrain degree, where the configuration is generator specific.</p>
</div>
<div class="paragraph">
<p>There are some configuration options which are shared by all generators:</p>
</div>
<table id="generator-options-common" class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. Common generator options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the base image from where to start when creating the images. By default the generators make an opinionated decision for the base image which are described in the respective generator section.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.generator.from</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias name for referencing this image in various other parts of the configuration. This is also used in the log output. The default alias name is the name of the generator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.generator.alias</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Docker image name used when doing Docker builds. For OpenShift S2I builds its the name of the image stream. This can be a pattern as descibed in <a href="#image-name-placeholders">Name Placeholders</a>. The default is <code>%g/%a:%l</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8.generator.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>merge</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this set to <code>true</code>, then the generator <em>adds</em> to an existing image configuration. By default this is disabled, so that a generator only kicks in when there are no other image configurations in the build, which are either configured directly for a <code>fabric8:build</code> or already by a generator which has been run previously.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When used as properties they can be directly referenced with the property names above.</p>
</div>
<div class="sect3">
<h4 id="generator-spring-boot">4.1.1. Spring Boot</h4>
<div class="paragraph">
<p>The name of this generator is <code>spring-boot</code> and gets activated when it finds a <code>spring-boot-maven-plugin</code> among the configured plugins. This plugin can be also a included as a dependency. It will use the following base image by default, but as explained <a href="#generator-options-common">above</a> and can be changeda <code>from</code> configuration.</p>
</div>
<table id="spring-boot-from" class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. Spring-Boot Base Images</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Docker Build</th>
<th class="tableblock halign-left valign-top">S2I Build</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Community</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8/java-alpine-openjdk8-jdk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fabric8/s2i-java</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Red Hat</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-java-openshift</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss-fuse-6/fis-java-openshift</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These images refer always to the latest tag. The <em>Red Hat</em> base images are selected, when the plugin itself is a Red Hat supported version (which is detected by the plugins version number).</p>
</div>
<div class="paragraph">
<p>The following additional configuration options can be set:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. Spring-Boot configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>webPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose as service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jolokiaPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Jolokia agent exposed by the base image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8778</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>prometheusPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Prometheus jmx_exporter exposed by the base image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9779</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="java-applications">4.1.2. Java Applications</h4>
<div class="paragraph">
<p>This generator is named <code>java-exec</code> and is responsible to start up arbitrary Java application. It kicks in if eithe the main class is explicitely configured in this generator&#8217;s configuration or when it finds a singel class with a <code>public static void main(String[] args)</code> method. If it finds more than one class, the generator is a no op.</p>
</div>
<div class="paragraph">
<p>It use the same default images as the <a href="#spring-boot-from">Spring Boot generator</a>.</p>
</div>
<div class="paragraph">
<p>Beside the common configuration parameters described in the table <a href="#generator-options-common">Commong Generator Options</a> it knows the following additional configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. Java Application configuration options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 75%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>mainClass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main class to call. If not given a class is tried to be found by scanning <code>target/classes</code> for a single class with a main method. If no if found or more than one is found, this generator does nothing.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>webPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to expose as service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jolokiaPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Jolokia agent exposed by the base image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8778</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>prometheusPort</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of the Prometheus jmx_exporter exposed by the base image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9779</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="karaf">4.1.3. Karaf</h4>

</div>
</div>
<div class="sect2">
<h3 id="generators-api">4.2. Generator API</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The API is still a bit in flux and will be documented later. Please refer to the  <a href="https://github.com/fabric8io/fabric8-maven-plugin/blob/master/generator/api/src/main/java/io/fabric8/maven/generator/api/Generator.java">Generator</a> Interface in the meantime.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enrichers">5. Enrichers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enriching is the complementary concept to <a href="#generators">Generators</a>. Whereas Generators are used to create and customize Docker images, Enrichers are use to create and customize Kubernetes and OpenShift resource objects.</p>
</div>
<div class="paragraph">
<p>There are a lot similarities to Generatos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Enricher has a unique name.</p>
</li>
<li>
<p>Enrichers are looked up automatically from dependencies provied and there is a set of default enrichers delivered with this plugin.</p>
</li>
<li>
<p>Enrichers are configured the same ways as generators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#generator-example">Generator example</a> is a good bluebprint, simply replace <code>&lt;generator&gt;</code> with <code>&lt;enricher&gt;</code>. The configuration is structural identical:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. Enricher configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;includes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains one ore more <code>&lt;include&gt;</code> elements with enricher names which should be included. If given, only this list of enrichers are included in this order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;excludes&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds one or more <code>&lt;exclude&gt;</code> elements with enricher names to exclude. This means all the detected enrichers are used except the ones mentioned in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for all enrichers. Each enricher supports a specific set of configuration values as described in its documentation. The subelements of this section are enricher names. E.g. for enricher <code>f8-service</code>, the sub-element is called <code>&lt;f8-service&gt;</code>. This element then holds the specific enricher configuration like <code>&lt;name&gt;</code> for the service name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This plugin comes with a set of default enrichers. In addition custom enrichers can be easily added by providing implementation of the <a href="#enricher-api">Enricher API</a> and adding these as a dependency to the build.</p>
</div>
<div class="sect2">
<h3 id="enrichers-default">5.1. Default Enrichers</h3>
<div class="paragraph">
<p>fabric8-maven-plugin comes with a set of enrichers which are enabled by default. There are two categories of default enrichers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Standard Enrichers</strong> are used to add default resource object when they are missing or add common metadata extracted from the given build information</p>
</li>
<li>
<p><strong>Fabric8 Enrichers</strong> are specific to the <a href="https://fabric8.io">fabric8 Microservice&#8217;s platform</a>. It adds icon annotations which are visible in the fabric8 console or connections to the Continous Deliverys systems like Jenkins or Gogs.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. Default Enrichers Overview</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enricher</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#f8-cd">f8-cd</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add CD metadata as annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#f8-doc-link">f8-doc-link</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add URL to documentation configured in the POM as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#f8-grafana-link">f8-grafana-link</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a Grafana Dashboard URL as annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#f8-icon">f8-icon</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an URL to icons for well known application types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-controller">fmp-controller</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create default controller (replication controller, replica set or deployment) if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-dependency">fmp-dependency</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Examine build dependencies for <code>kubernetes.yml</code> and add the objects found therein.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-git">fmp-git</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check local <code>.git</code> directory and add build information as annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-image">fmp-image</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add the image name into a <code>PodSpec</code> of replication controller, replication sets and deployments, if missing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-name">fmp-name</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a default name to every object which misses a name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-project">fmp-project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Maven coordinates as labels to all objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmp-service">fmp-service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a default service if missing and extrac ports from the Docker image configuration.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="enrichers-standard">5.1.1. Standard Enrichers</h4>
<div class="paragraph">
<p>Default enrichers are used for adding missing resources or adding metadata to given resource objects. The following default enhancers are availables out of the box</p>
</div>
<div class="sect4">
<h5 id="fmp-controller">fmp-controller</h5>

</div>
<div class="sect4">
<h5 id="fmp-service">fmp-service</h5>

</div>
<div class="sect4">
<h5 id="fmp-image">fmp-image</h5>

</div>
<div class="sect4">
<h5 id="fmp-name">fmp-name</h5>

</div>
<div class="sect4">
<h5 id="fmp-project">fmp-project</h5>

</div>
<div class="sect4">
<h5 id="fmp-git">fmp-git</h5>

</div>
<div class="sect4">
<h5 id="fmp-dependency">fmp-dependency</h5>

</div>
</div>
<div class="sect3">
<h4 id="enrichers-fabric8">5.1.2. Fabric8 Enrichers</h4>
<div class="paragraph">
<p>Fabric8 enrichers are used for providing the connection to other components of the fabric8 Microservices platform. They are useful to add icons to to application or links to documentation sites.</p>
</div>
<div class="sect4">
<h5 id="f8-cd">f8-cd</h5>

</div>
<div class="sect4">
<h5 id="f8-doc-link">f8-doc-link</h5>

</div>
<div class="sect4">
<h5 id="f8-grafana-link">f8-grafana-link</h5>

</div>
<div class="sect4">
<h5 id="f8-icon">f8-icon</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="enricher-api">5.2. Enricher API</h3>
<div class="paragraph">
<p><em>howto write your own enricher and install them</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profiles">6. Profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Profiles can be used to combine a set of enrichers and generators and gives this combination a referenceable name. Profiles can be defined externally either directly as a build resource in <code>src/main/fabric8/profiles.yml</code> or provided as part of a plugin&#8217;s dependency where it is supposed to be included as <code>META-INF/fabric8/profiles.yml</code>. Multiple profiles can be added in these <code>profiles.yml</code> descriptors.</p>
</div>
<div class="paragraph">
<p>Profiles are defined in YAML. The following example shows a simple profiles which uses only the <a href="#generator-spring-boot">Spring Boot generator</a> and only those enrichers adding default objects:</p>
</div>
<div class="listingblock">
<div class="title">Profile Definition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: my-spring-boot-apps</span></span>
  <span class="key">generator</span>:
    <span class="key">includes</span>:
      - <span class="string"><span class="content">spring-boot</span></span>
  <span class="key">enrichers</span>:
    <span class="key">includes</span>:
      <span class="comment"># Default Deployment object</span>
      - <span class="string"><span class="content">fmp-controller</span></span>
      <span class="comment"># Add a default service</span>
      - <span class="string"><span class="content">fmp-service</span></span>
  <span class="key">config</span>:
    <span class="key">fmp-service</span>:
      <span class="comment"># Expose service as NodePort</span>
      <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This profile then can be referenced from various plugin goals. The easiest way is to add the profile as top-level configuration parameter.</p>
</div>
<div class="listingblock">
<div class="title">Specification of profile in plugin configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;profile&gt;</span>my-spring-boot-apps<span class="tag">&lt;/profile&gt;</span>
    .....
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively a profile can be also specified on the command line when calling Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Dfabric8.profile=my-spring-boot-apps fabric8:build fabric8:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a configuration for enrichers and generators are provided as part of the plugin&#8217;s <code>&lt;configuration&gt;</code> then this takes precedence over any profile specified.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access-configuration">7. Access configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="docker-access">7.1. Docker Access</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This section is work-in-progress and not yet finished
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Kubernetes builds the fabric8-maven-plugin uses the Docker remote API so the URL of your Docker Daemon must be specified. The URL can be specified by the dockerHost or machine configuration, or by the <code>DOCKER_HOST</code> environment variable. If not given</p>
</div>
<div class="paragraph">
<p>The Docker remote API supports communication via SSL and
authentication with certificates.  The path to the certificates can
be specified by the certPath or machine configuration, or by the
<code>DOCKER_CERT_PATH</code> environment variable.</p>
</div>
</div>
<div class="sect2">
<h3 id="openshift-and-kubernetes-access">7.2. OpenShift and Kubernetes Access</h3>
<div class="paragraph">
<p>If no <code>DOCKER_HOST</code> is set and no unix socket could be accessed under <code>/var/run/docker.sock</code> then f-m-p checks whethe <a href="https://github.com/fabric8io/gofabric8">gofabric8</a> is in the path and uses <code>gofabric8 docker-env</code> to get the connection parameter to the Docker host exposed by</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry">8. Registry handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker uses registries to store images. The registry is typically
specified as part of the name. I.e. if the first part (everything
before the first <code>/</code>) contains a dot (<code>.</code>) or colon (<code>:</code>) this part is
interpreted as an address (with an optionally port) of a remote
registry. This registry (or the default <code>docker.io</code> if no
registry is given) is used during push and pull operations. This
plugin follows the same semantics, so if an image name is specified
with a registry part, this registry is contacted. Authentication is
explained in the next <a href="#_authentication">section</a>.</p>
</div>
<div class="paragraph">
<p>There are some situations however where you want to have more
flexibility for specifying a remote registry. This might be, because
you do not want to hard code a registry into <code>pom.xml</code> but
provide it from the outside with an environment variable or a system
property.</p>
</div>
<div class="paragraph">
<p>This plugin supports various ways of specifying a registry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the image name contains a registry part, this registry is used
unconditionally and can not be overwritten from the outside.</p>
</li>
<li>
<p>If an image name doesn&#8217;t contain a registry, then by default the
default Docker registry <code>docker.io</code> is used for push and pull
operations. But this can be overwritten through various means:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>&lt;image&gt;</code> configuration contains a <code>&lt;registry&gt;</code> subelement
this registry is used.</p>
</li>
<li>
<p>Otherwise, a global configuration element <code>&lt;registry&gt;</code> is
evaluated which can be also provided as system property via
<code>-Ddocker.registry</code>.</p>
</li>
<li>
<p>Finally an environment variable <code>DOCKER_REGISTRY</code> is looked up for
detecting a registry.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This registry is used for pulling (i.e. for autopull the base image
when doing a <code>fabric8:build</code>) and pushing with <code>docker.push</code>. However,
when these two goals a are combined on the command line like in <code>mvn
-Ddocker.registry=myregistry:5000 package fabric8:build fabric8:push</code>
the same registry is used for both operation. For a more fine grained
control, separate registries for <em>pull</em> and <em>push</em> can be specified.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the plugin&#8217;s configuration with the parameters <code>&lt;pullRegistry&gt;</code> and
<code>&lt;pushRegistry&gt;</code>, respectively.</p>
</li>
<li>
<p>With the system properties <code>docker.pull.registry</code> and
<code>docker.push.registry</code>, respectively.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;registry&gt;</span>docker.jolokia.org:443<span class="tag">&lt;/registry&gt;</span>
  <span class="tag">&lt;images&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="comment">&lt;!-- Without an explicit registry ... --&gt;</span>
      <span class="tag">&lt;name&gt;</span>jolokia/jolokia-java<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- ... hence use this registry --&gt;</span>
      <span class="tag">&lt;registry&gt;</span>docker.ro14nd.de<span class="tag">&lt;/registry&gt;</span>
      ....
    <span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="tag">&lt;name&gt;</span>postgresql<span class="tag">&lt;/name&gt;</span>
      <span class="comment">&lt;!-- No registry in the name, hence use the globally
           configured docker.jolokia.org:443 as registry --&gt;</span>
      ....
    <span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;image&gt;</span>
      <span class="comment">&lt;!-- Explicitely specified always wins --&gt;</span>
      <span class="tag">&lt;name&gt;</span>docker.example.com:5000/another/server<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;/image&gt;</span>
  <span class="tag">&lt;/images&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is some special behaviour when using an externally provided
registry like described above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When <em>pulling</em>, the image pulled will be also tagged with a repository
name <strong>without</strong> registry. The reasoning behind this is that this
image then can be referenced also by the configuration when the
registry is not specified anymore explicitly.</p>
</li>
<li>
<p>When <em>pushing</em> a local image, temporarily a tag including the
registry is added and removed after the push. This is required
because Docker can only push registry-named images.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication">9. Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When pulling (via the <code>autoPull</code> mode of <code>fabric8:start</code>) or pushing image, it
might be necessary to authenticate against a Docker registry.</p>
</div>
<div class="paragraph">
<p>There are three different ways for providing credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a <code>&lt;authConfig&gt;</code> section in the plugin configuration with
<code>&lt;username&gt;</code> and <code>&lt;password&gt;</code> elements.</p>
</li>
<li>
<p>Providing system properties <code>docker.username</code> and <code>docker.password</code>
from the outside</p>
</li>
<li>
<p>Using a <code>&lt;server&gt;</code> configuration in <code>~/.m2/settings.xml</code></p>
</li>
<li>
<p>Login into a registry with <code>docker login</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the username and password directly in the <code>pom.xml</code> is not
recommended since this is widely visible. This is most easiest and
transparent way, though. Using an <code>&lt;authConfig&gt;</code> is straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;image&gt;</span>consol/tomcat-7.0<span class="tag">&lt;/image&gt;</span>
    ...
    <span class="tag">&lt;authConfig&gt;</span>
      <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
      <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
    <span class="tag">&lt;/authConfig&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The system property provided credentials are a good compromise when
using CI servers like Jenkins. You simply provide the credentials from
the outside:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Ddocker.username=jolokia -Ddocker.password=s!cr!t fabric8:push</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most secure and also the most <em>mavenish</em> way is to add a server to
the Maven settings file <code>~/.m2/settings.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servers&gt;</span>
  <span class="tag">&lt;server&gt;</span>
    <span class="tag">&lt;id&gt;</span>docker.io<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
    <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
  <span class="tag">&lt;/server&gt;</span>
  ....
<span class="tag">&lt;/servers&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server id must specify the registry to push to/pull from, which by
default is central index <code>docker.io</code> (or <code>index.docker.io</code> / <code>registry.hub.docker.com</code> as fallbacks).
Here you should add your docker.io account for your repositories. If you have multiple accounts
for the same registry, the second user can be specified as part of the ID. In the example above, if you
have a second accorunt 'fabric8io' then use an <code>&lt;id&gt;docker.io/fabric8io&lt;/id&gt;</code> for this second entry. I.e. add the
username with a slash to the id name. The default without username is only taken if no server entry with
a username appended id is chosen.</p>
</div>
<div class="paragraph">
<p>As a final fallback, this plugin consults <code>~/.docker/config.json</code> for getting to the credentials. Within this
file credentials are stored when connecting to a registry with the command <code>docker login</code> from the command line.</p>
</div>
<div class="sect2">
<h3 id="pull-vs-push-authentication">9.1. Pull vs. Push Authentication</h3>
<div class="paragraph">
<p>The credentials lookup described above is valid for both push and
pull operations. In order to narrow things down, credentials can be be
provided for pull or push operations alone:</p>
</div>
<div class="paragraph">
<p>In an <code>&lt;authConfig&gt;</code> section a sub-section <code>&lt;pull&gt;</code> and/or <code>&lt;push&gt;</code>
can be added. In the example below the credentials provider are only
used for image push operations:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;image&gt;</span>consol/tomcat-7.0<span class="tag">&lt;/image&gt;</span>
    ...
    <span class="tag">&lt;authConfig&gt;</span>
      <span class="tag">&lt;push&gt;</span>
         <span class="tag">&lt;username&gt;</span>jolokia<span class="tag">&lt;/username&gt;</span>
         <span class="tag">&lt;password&gt;</span>s!cr!t<span class="tag">&lt;/password&gt;</span>
      <span class="tag">&lt;/push&gt;</span>
    <span class="tag">&lt;/authConfig&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the credentials are given on the command line as system
properties, then the properties <code>docker.pull.username</code> /
<code>docker.pull.password</code> and <code>docker.push.username</code> /
<code>docker.push.password</code> are used for pull and push operations,
respectively (when given). Either way, the standard lookup algorithm
as described in the previous section is used as fallback.</p>
</div>
</div>
<div class="sect2">
<h3 id="openshift-authentication">9.2. OpenShift Authentication</h3>
<div class="paragraph">
<p>When working with the default registry in OpenShift, the credentials
to authtenticate are the OpenShift username and access token. So, a
typical interaction with the OpenShift registry from the outside is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc login
...
mvn -Ddocker.registry=docker-registry.domain.com:80/default/myimage \
    -Ddocker.username=$(oc whoami) \
    -Ddocker.password=$(oc whoami -t)</pre>
</div>
</div>
<div class="paragraph">
<p>(note, that the image&#8217;s user name part ("default" here") must
correspond to an OpenShift project with the same name to which you
currently connected account has access).</p>
</div>
<div class="paragraph">
<p>This can be simplified by using the system property
<code>docker.useOpenShiftAuth</code> in which case the plugin does the
lookup. The equivalent to the example above is</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc login
...
mvn -Ddocker.registry=docker-registry.domain.com:80/default/myimage \
    -Ddocker.useOpenShiftAuth</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the configuration option <code>&lt;useOpenShiftAuth&gt;</code> can be
added to the <code>&lt;authConfig&gt;</code> section.</p>
</div>
<div class="paragraph">
<p>For dedicted <em>pull</em> and <em>push</em> configuration the system properties
<code>docker.pull.useOpenShiftAuth</code> and <code>docker.push.useOpenShiftAuth</code> are
available as well as the configuration option <code>&lt;useOpenShiftAuth&gt;</code> in
an <code>&lt;pull&gt;</code> or <code>&lt;push&gt;</code> section within the <code>&lt;authConfig&gt;</code>
configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="password-encryption">9.3. Password encryption</h3>
<div class="paragraph">
<p>Regardless which mode you choose you can encrypt password as described
in the
<a href="http://maven.apache.org/guides/mini/guide-encryption.html">Maven documentation</a>. Assuming
that you have setup a <em>master password</em> in
<code>~/.m2/security-settings.xml</code> you can create easily encrypted
passwords:</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mvn --encrypt-password
Password:
{QJ6wvuEfacMHklqsmrtrn1/ClOLqLm8hB7yUL23KOKo=}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This password then can be used in <code>authConfig</code>, <code>docker.password</code>
and/or the <code>&lt;server&gt;</code> setting configuration. However, putting an
encrypted password into <code>authConfig</code> in the <code>pom.xml</code> doesn&#8217;t make
much sense, since this password is encrypted with an individual master
password.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration">10. Migration from version 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This version 3 of f8-m-p is using a completely new configuration syntax compated to version 2.</p>
</div>
<div class="paragraph">
<p>If you have a maven project with a 2.x fabric8-maven-plugin then we recommend you run the <a href="http://fabric8.io/guide/mavenFabric8Migrate.html">mvn fabric8:migrate</a> goal directly on your project to do the migration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># in a fabric8-maven-plugin 2.x project
mvn fabric8:migrate
# now the project is using 3.x or later</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the project is migrated to 3.x or later of the fabric8-maven-plugin you can then run this <code>fabric8:setup</code> goal at any time to update to the latest plugin and goals.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.1.42<br>
Last updated 2016-09-21 15:15:29 UTC
</div>
</div>
</body>
</html>